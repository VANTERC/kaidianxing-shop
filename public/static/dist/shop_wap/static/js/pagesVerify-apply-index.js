(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([[147],{"18c3":function(i,t,e){var n=e("24fb");t=n(!1),t.push([i.i,'@charset "UTF-8";\n/* 颜色变量 */\n/* 行为相关颜色 */\n/* 文字基本颜色 */\n/* 背景颜色 */\n/* 边框颜色 */\n/* 尺寸变量 */\n/* 文字尺寸 */\n/* 图片尺寸 */\n/* Border Radius */\n/* 水平间距 */\n/* 垂直间距 */\n/* 透明度 */\n/* 文章场景相关 */.verify-apply[data-v-2abc0ea0]{padding:0 %?64?% 0;height:100vh;background-color:#fff;box-sizing:border-box}.verify-apply .verify-content[data-v-2abc0ea0]{padding-top:%?94?%;-webkit-box-align:center;-webkit-align-items:center;align-items:center;height:%?886?%}.verify-apply .verify-content .shop-logo[data-v-2abc0ea0]{width:%?144?%;height:%?144?%;border-radius:50%}.verify-apply .verify-content .shop-name[data-v-2abc0ea0]{margin:%?32?% 0 %?278?%;line-height:%?68?%;text-align:center;font-size:%?48?%}.verify-apply .verify-content .info[data-v-2abc0ea0]{line-height:%?44?%;font-size:%?32?%;text-align:center}.verify-apply .verify-content .verify-user-img[data-v-2abc0ea0]{margin-bottom:%?32?%;width:%?200?%;height:%?200?%}.verify-apply .btn[data-v-2abc0ea0]{width:%?622?%;height:%?80?%;line-height:%?80?%;background-color:#fff;color:#ff3c29;text-align:center;font-size:%?28?%;border-radius:%?40?%;border:1px solid #ff3c29}.verify-apply .btn.primary[data-v-2abc0ea0]{margin-bottom:%?32?%;background-color:#ff3c29;color:#fff;box-shadow:0 4px 4px rgba(254,108,83,.25);border:0}',""]),i.exports=t},"19a3":function(i,t,e){"use strict";e.r(t);var n=e("5d77"),o=e("87be");for(var r in o)["default"].indexOf(r)<0&&function(i){e.d(t,i,(function(){return o[i]}))}(r);e("d051");var s,a=e("f0c5"),u=Object(a["a"])(o["default"],n["b"],n["c"],!1,null,"2abc0ea0",null,!1,n["a"],s);t["default"]=u.exports},2193:function(i,t,e){(function(i){var n=e("288e");e("8e6e"),Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0,e("96cf");var o=n(e("3b8d"));e("456d"),e("28a5"),e("ac6a");var r=n(e("bd86")),s=e("2f62");function a(i,t){var e=Object.keys(i);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(i);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(i,t).enumerable}))),e.push.apply(e,n)}return e}function u(i){for(var t=1;t<arguments.length;t++){var e=null!=arguments[t]?arguments[t]:{};t%2?a(Object(e),!0).forEach((function(t){(0,r.default)(i,t,e[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(i,Object.getOwnPropertyDescriptors(e)):a(Object(e)).forEach((function(t){Object.defineProperty(i,t,Object.getOwnPropertyDescriptor(e,t))}))}return i}var l=[],c={name:"index",components:{},props:{},data:function(){return{is_verify:!1,is_bind:!1,is_operator:!1,is_success:!1,is_invalid:!1,bind_verify:!1,btnLoad:!1,uid:"",flag:"",time:"",type:{weixin:"wxapp",toutiao:"toutiao",douyin:"douyin",news_article_lite:"toutiaoLite",devtools:"toutiao"}}},computed:u(u({},(0,s.mapGetters)("login",["isSkip","isLogin","isBind","userInfo"])),(0,s.mapState)("setting",{shopName:function(i){var t,e;return(null===(t=i.systemSetting)||void 0===t||null===(e=t.basic)||void 0===e?void 0:e.name)||""},shopLogo:function(i){var t,e;return(null===(t=i.systemSetting)||void 0===t||null===(e=t.basic)||void 0===e?void 0:e.logo)||""}})),watch:{isLogin:{immediate:!0,handler:function(t){var e=this;i.log(t,"VAL>>>>>>>>>>>"),"boolean"==typeof this.isLogin&&l.length&&(l.forEach((function(i){"function"==typeof i&&i(e.isLogin)})),l=[])}},userInfo:{handler:function(i){null!==i&&void 0!==i&&i.id&&!this.is_invalid&&this.isOperator()},immediate:!0}},onLoad:function(){var i;if(this.$loading.showLoading(),null!==(i=this.$Route.query)&&void 0!==i&&i.scene){var t,e,n,o,r,s,a,u,l,c,d,f,v=decodeURIComponent(null===(t=this.$Route)||void 0===t||null===(e=t.query)||void 0===e?void 0:e.scene),p=v.split("&"),h=p.filter((function(i){return i.indexOf("uid")>-1})),g=p.filter((function(i){return i.indexOf("time")>-1})),b=p.filter((function(i){return i.indexOf("flag")>-1}));if(null!==h&&void 0!==h&&h.length&&null!==(n=paramsData)&&void 0!==n&&n.length)this.uid=(null===h||void 0===h||null===(o=h[0])||void 0===o||null===(r=o.split("="))||void 0===r?void 0:r[1])+(null===(s=paramsData)||void 0===s||null===(a=s[0])||void 0===a||null===(u=a.split("="))||void 0===u?void 0:u[1]),this.time=null===g||void 0===g||null===(l=g[0])||void 0===l||null===(c=l.split("="))||void 0===c?void 0:c[1],this.flag=(null===b||void 0===b||null===(d=b[0])||void 0===d||null===(f=d.split("="))||void 0===f?void 0:f[1])||""}else{var m,y,_,w,$,O;this.uid=(null===(m=this.$Route)||void 0===m||null===(y=m.query)||void 0===y?void 0:y.uid)||"",this.time=(null===(_=this.$Route)||void 0===_||null===(w=_.query)||void 0===w?void 0:w.time)||"",this.flag=(null===($=this.$Route)||void 0===$||null===(O=$.query)||void 0===O?void 0:O.flag)||""}this.handleInvalid()},mounted:function(){},methods:u(u({},(0,s.mapMutations)("login",["setLogin","startSkip","setOldLength","setBindUser","setBind"])),{},{handleInvalid:function(){var t=this;this.$api.verifyApi.invalid({time:this.time},{errorToast:!1}).then((function(e){if(i.log(e,"handleInvalid>>>>>>>>>>>>>>>>>>"),211291===e.error)return t.is_invalid=!0,void t.$loading.hideLoading();"boolean"==typeof t.isLogin?t.isOperator():l.push((function(){t.isOperator()}))}))},btnClick:function(){var i=this;if(this.$utils.is_weixin()){var t=this.$Route,e=t.path,n=t.query,o={target_url:e,type:"wechat"};Object.keys(n).length&&(o.target_params=JSON.stringify(n)),this.$api.loginApi.postAuth(o).then((function(t){t&&(i.setOldLength(history.length),location.href=t.message)}))}else this.$Router.auto({path:"/pagesLogin/index"})},isOperator:function(){var t,e,n=this;i.log(null===this||void 0===this||null===(t=this.userInfo)||void 0===t?void 0:t.id,"memberid>>>>>>>>>>"),this.$api.verifyApi.isOperator({member_id:null===this||void 0===this||null===(e=this.userInfo)||void 0===e?void 0:e.id,uid:this.uid},{errorToast:!1}).then((function(t){switch(i.log(t,"login-after----------"),t.error){case 211291:n.is_invalid=!0;break;case 211290:n.is_operator=!0;break;case 211289:n.is_verify=!0;break;case 211222:n.is_bind=!0;break;case 211292:n.is_bind=!1,n.bind_verify=!0;break;case 0:n.is_success=!0;break}n.$loading.hideLoading()})).finally((function(){n.$loading.hideLoading()}))},getUserInfo:function(t,e){var n=this;this.btnLoad||(this.btnLoad=!0,uni.login({provider:e,success:function(t){var o={type:n.type[e],code:t.code};n.$api.loginApi.postAuth(o).then((function(i){})).catch((function(t){i.log(t,"error")}))},complete:function(){n.btnLoad=!1}}))},loginAlign:function(i){var t=this;uni.getUserInfo({provider:i,success:function(e){t.getUserInfo({detail:e},i)}})},postData:function(i,t){var e=this;this.$api.loginApi.getLogin(u(u({},i),{},{type:this.type[t]}),{errorToast:!1}).then((function(i){0===i.error?(e.$toast("登录成功"),e.setLogin(!0),e.$api.memberApi.getUserInfo().then((function(i){e.$store.commit("login/setUserInfo",i.data),e.isOperator()}))):-1===i.error&&e.loginAlign(t)}))},ttGetAuthorize:function(i,t){var e=this;uni.getSetting({success:function(n){n.authSetting["scope.userInfo"]?e.ttGetUserInfo(i,t):uni.authorize({scope:"scope.userInfo",success:function(){e.ttGetUserInfo(i,t)},fail:function(n){uni.showModal({title:"是否授权用户信息",success:function(n){n.confirm&&e.ttOpenAuth(i,t)}})}})}})},ttOpenAuth:function(t,e){var n=this;uni.openSetting({success:function(o){i.log("openSetting"),o.authSetting["scope.userInfo"]&&n.ttGetUserInfo(t,e)}})},ttGetUserInfo:function(i,t){var e=this;uni.getUserInfo({provider:"toutiao",withCredentials:!0,success:function(n){var o={iv:n.iv,session_key:i,encryptedData:n.encryptedData,rawData:n.rawData,signature:n.signature};e.postData(o,t)},fail:function(i){e.$toast("获取信息失败")}})},redirectBindTel:function(){var i=this;this.isSkip||"/pagesMember/bindTel/mobile"===this.$Route.path||(this.startSkip(!0),this.setBindParams(),this.$Router.auto("/pagesMember/bindTel/mobile"),setTimeout((function(){i.startSkip(!1)}),500))},setBindParams:function(){var i={uid:this.uid,time:this.time,flag:this.flag};this.localStorage.setItem("bindVerify",JSON.stringify(i))},getPhoneNumber:function(){var i=(0,o.default)(regeneratorRuntime.mark((function i(t){var e=this;return regeneratorRuntime.wrap((function(i){while(1)switch(i.prev=i.next){case 0:return i.next=2,this.sendMsg();case 2:if(!this.btnLoad){i.next=4;break}return i.abrupt("return");case 4:this.btnLoad=!0,uni.login({provider:"weixin",success:function(i){e.$api.loginApi.postAuth({type:"wxapp",code:i.code}).then((function(i){var n={iv:t.detail.iv,session_key:i.session_key,encryptedData:t.detail.encryptedData};e.toBindMobile(n)}))},complete:function(){e.btnLoad=!1}});case 6:case"end":return i.stop()}}),i,this)})));function t(t){return i.apply(this,arguments)}return t}(),toBindMobile:function(i){var t=this;this.$api.loginApi.getLogin(u(u({},i),{},{type:"wxapp",get_mobile:"1"})).then((function(i){0===i.error&&t.bindMobile(i.purePhoneNumber)}))},bindMobile:function(i){var t=this;this.$api.loginApi.bindMobile({mobile:i,is_auth:"1"}).then((function(i){if(0===i.error)t.setBind(!0),t.is_bind=!1,t.isOperator();else if(211265===i.error){var e=i.user,n=i.bind_user,o=i.bind_mobile;t.setBindUser({user:e,bind_user:n,bind_mobile:o}),t.setBindParams(),t.$Router.auto({path:"/pagesMember/bindTel/hadBound"})}else-1===i.error&&t.$toast("绑定失败,请重新绑定")}))},toMember:function(){this.$Router.replaceAll({path:"/pagesMember/index/index"})},bindVerify:function(){var i=(0,o.default)(regeneratorRuntime.mark((function i(){var t,e=this;return regeneratorRuntime.wrap((function(i){while(1)switch(i.prev=i.next){case 0:this.$api.verifyApi.bindVerify({member_id:null===this||void 0===this||null===(t=this.userInfo)||void 0===t?void 0:t.id,uid:this.uid,time:this.time}).then((function(i){0===i.error&&(e.localStorage.removeItem("bindVerify"),e.bind_verify=!1,e.is_success=!0)}));case 1:case"end":return i.stop()}}),i,this)})));function t(){return i.apply(this,arguments)}return t}(),sendMsg:function(){var t=this;return new Promise((function(e){t.$api.othersApi.getNoticeTemId({type_code:["verify_qrcode_bind_success"]},{errorToast:!1}).then((function(t){0==t.error?wx.requestSubscribeMessage({tmplIds:t.data,success:function(t){i.log(t)},fail:function(t){i.log(t)},complete:function(i){e()}}):e()}))}))}})};t.default=c}).call(this,e("5a52")["default"])},"5d77":function(i,t,e){"use strict";var n;e.d(t,"b",(function(){return o})),e.d(t,"c",(function(){return r})),e.d(t,"a",(function(){return n}));var o=function(){var i=this,t=i.$createElement,e=i._self._c||t;return e("kdx-page-box",{attrs:{noLogin:!0,noBind:!0,manualBind:!0}},[e("div",{staticClass:"verify-apply"},[e("div",{staticClass:"verify-content flex-column"},[i.is_invalid?[e("img",{staticClass:"verify-user-img",attrs:{src:i.$utils.staticImg("verify/"+("link"===i.flag?"link":"qrcode")+"_invalid.png"),alt:""}}),e("div",{staticClass:"info"},[e("div",[i._v("链接已失效")])])]:[!i.isLogin||i.is_bind||i.bind_verify?[e("img",{staticClass:"shop-logo",attrs:{src:i.$utils.media(i.shopLogo),alt:""}}),e("div",{staticClass:"shop-name"},[i._v(i._s("欢迎来到"+i.shopName))]),e("div",{staticClass:"info"},[e("div",[i._v("邀请您成为核销员")]),i.isLogin?e("div",[i._v("点击绑定核销员身份")]):e("div",[i._v("请登录以绑定核销员身份")])])]:i._e(),i.is_verify||i.is_operator||i.is_success?[e("img",{staticClass:"verify-user-img",attrs:{src:i.$utils.staticImg("verify/verify-user.png"),alt:""}}),e("div",{staticClass:"info"},[i.is_success?e("div",[i._v("您已经成功绑定核销员")]):i._e(),i.is_verify?[e("div",[i._v("您已有核销权限")]),e("div",[i._v("无需绑定")])]:i._e(),i.is_operator?[e("div",[i._v("您的账号已绑定过系统操作员")]),e("div",[i._v("请联系管理员授权核销权限")])]:i._e()],2)]:i._e()]],2),e("div",{staticClass:"btn-box"},[i.is_invalid?i._e():[i.isLogin?i._e():[e("div",{staticClass:"btn primary theme-primary-bgcolor",on:{click:function(t){arguments[0]=t=i.$handleEvent(t),i.btnClick.apply(void 0,arguments)}}},[i._v("立即登录")])],i.is_verify||i.is_success?e("div",{staticClass:"btn primary theme-primary-bgcolor",on:{click:function(t){arguments[0]=t=i.$handleEvent(t),i.toMember.apply(void 0,arguments)}}},[i._v("前往核销入口")]):i._e(),i.is_bind?e("v-uni-button",{staticClass:"btn primary theme-primary-bgcolor",on:{click:function(t){arguments[0]=t=i.$handleEvent(t),i.redirectBindTel.apply(void 0,arguments)}}},[i._v("立即绑定")]):i._e(),i.bind_verify?e("v-uni-button",{staticClass:"btn primary theme-primary-bgcolor",on:{click:function(t){arguments[0]=t=i.$handleEvent(t),i.bindVerify.apply(void 0,arguments)}}},[i._v("立即绑定")]):i._e(),!i.isLogin||i.is_bind||i.bind_verify?e("div",{staticClass:"btn theme-primary-border theme-primary-color",on:{click:function(t){arguments[0]=t=i.$handleEvent(t),i.toMember.apply(void 0,arguments)}}},[i._v("我是核销员，前往核销入口")]):i._e()]],2)])])},r=[]},"87be":function(i,t,e){"use strict";e.r(t);var n=e("2193"),o=e.n(n);for(var r in n)["default"].indexOf(r)<0&&function(i){e.d(t,i,(function(){return n[i]}))}(r);t["default"]=o.a},d051:function(i,t,e){"use strict";var n=e("dc1f"),o=e.n(n);o.a},dc1f:function(i,t,e){var n=e("18c3");"string"===typeof n&&(n=[[i.i,n,""]]),n.locals&&(i.exports=n.locals);var o=e("4f06").default;o("794a3830",n,!0,{sourceMap:!1,shadowMode:!1})}}]);