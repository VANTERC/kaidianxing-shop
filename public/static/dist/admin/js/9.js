(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([[9],{"15fd":function(t,e,s){s("a4d3"),s("c975"),Object.defineProperty(e,"__esModule",{value:!0}),e.default=n;var a=i(s("ccb5"));function i(t){return t&&t.__esModule?t:{default:t}}function n(t,e){if(null==t)return{};var s,i,n=(0,a.default)(t,e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(t);for(i=0;i<r.length;i++)s=r[i],e.indexOf(s)>=0||Object.prototype.propertyIsEnumerable.call(t,s)&&(n[s]=t[s])}return n}},"1aec":function(t,e,s){Object.defineProperty(e,"__esModule",{value:!0}),e.executeUpgrade=e.getUpgradeStatus=e.startUpgrade=e.getUpgradeInfo=e.resetRepair=e.completeSystemRepair=e.executeScriptSystemRepair=e.executeSystemRepair=e.downloadFile=e.requestSystemRepair=e.checkSystemRepair=e.initSystemRepair=e.getVersionLog=e.getSystemAuth=e.getUpdateLog=void 0;var a=s("66df"),i=function(t){return(0,a.get)("admin/system/update-log/get-list",t)};e.getUpdateLog=i;var n=function(t){return(0,a.get)("admin/system/auth/get",t)};e.getSystemAuth=n;var r=function(t){return(0,a.get)("admin/system/update-log/get-version-log",t)};e.getVersionLog=r;var o=function(t){return(0,a.get)("admin/system/repair/init",t)};e.initSystemRepair=o;var c=function(t){return(0,a.get)("admin/system/repair/check",t)};e.checkSystemRepair=c;var u=function(t){return(0,a.get)("admin/system/repair/request",t)};e.requestSystemRepair=u;var d=function(t){return(0,a.get)("admin/system/repair/download-file",t)};e.downloadFile=d;var l=function(t){return(0,a.get)("admin/system/repair/execute",t)};e.executeSystemRepair=l;var p=function(t){return(0,a.get)("admin/system/repair/execute-script",t)};e.executeScriptSystemRepair=p;var g=function(t){return(0,a.get)("admin/system/repair/complete",t)};e.completeSystemRepair=g;var f=function(t){return(0,a.get)("admin/system/repair/reset",t)};e.resetRepair=f;var v=function(t){return(0,a.get)("admin/system/upgrade/init",t)};e.getUpgradeInfo=v;var m=function(t){return(0,a.post)("admin/system/upgrade/start",t)};e.startUpgrade=m;var h=function(t){return(0,a.get)("admin/system/upgrade/get-status",t)};e.getUpgradeStatus=h;var _=function(t){return(0,a.post)("admin/system/upgrade/execute",t)};e.executeUpgrade=_},"326c":function(t,e,s){"use strict";s.r(e);var a=s("fe61"),i=s.n(a);for(var n in a)"default"!==n&&function(t){s.d(e,t,(function(){return a[t]}))}(n);e["default"]=i.a},"333a":function(t,e,s){},4536:function(t,e,s){},"622b":function(t,e,s){"use strict";var a=s("333a"),i=s.n(a);i.a},"78aa":function(t,e,s){"use strict";s.r(e);var a=s("cb54"),i=s.n(a);for(var n in a)"default"!==n&&function(t){s.d(e,t,(function(){return a[t]}))}(n);e["default"]=i.a},"7f49":function(t,e,s){"use strict";s.d(e,"a",(function(){return a})),s.d(e,"b",(function(){return i}));var a=function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("content-bar",[s("div",{staticClass:"content"},[s("div",{staticClass:"title",on:{click:t.upgradeInit}},[s("form-title",{attrs:{hasMargin:!1}},[t._v("系统升级")])],1),s("div",{staticClass:"isnew"},[s("div",{staticClass:"version-info"},[t.versionInfo?s("div",{staticClass:"version-info-tips"},[t._v(" 当前为最新版本 ")]):t._e(),s("div",{staticClass:"version-info-code"},[t._v(" "+t._s(t.versionInfo.version)+" ")]),s("div",{staticClass:"version-info-time"},[t._v(" 发布于"+t._s(t.versionInfo.release_time)+" ")])]),t.isVersionInfoLogs?s("div",{staticClass:"update-info"},[s("ul",t._l(t.updateLogs,(function(e,a){return s("li",{key:a},[s("div",{staticClass:"left",class:{add:"新增"===e.type,optimization:"优化"===e.type,repair:"修复"===e.type}},[t._v(" "+t._s(e.type)+" ")]),s("div",{staticClass:"right",domProps:{innerHTML:t._s(e.content)}})])})),0)]):t._e(),s("div",{staticClass:"upgrade-status"},[s("div",{staticClass:"item"},[s("div",{staticClass:"text",staticStyle:{"font-size":"12px",color:"#939799","line-height":"16px"}},[t._v(" 上次升级时间："+t._s(t.latest_upgrade_time||"-")+" ")])])]),t.local_version.is_latest?t._e():s("div",{staticClass:"btn-box"},[s("div",{staticClass:"operate-btn",on:{click:t.startUpgrade}},[t._v("立即升级")])])])]),t.versionInfo.id?s("common-modal",{attrs:{"patch-id":t.versionInfo.id,"current-step":t.versionInfo.step},on:{"on-success":t.upgradeInit,"on-step-change":t.stepChange},model:{value:t.modalShowFlag,callback:function(e){t.modalShowFlag=e},expression:"modalShowFlag"}}):t._e()],1)},i=[]},"804d":function(t,e,s){"use strict";s.r(e);var a=s("f038"),i=s("78aa");for(var n in i)"default"!==n&&function(t){s.d(e,t,(function(){return i[t]}))}(n);s("622b");var r=s("2877"),o=Object(r["a"])(i["default"],a["a"],a["b"],!1,null,"a93d98ec",null);e["default"]=o.exports},"94f3":function(t,e,s){"use strict";var a=s("4536"),i=s.n(a);i.a},c983:function(t,e,s){"use strict";s.r(e);var a=s("7f49"),i=s("326c");for(var n in i)"default"!==n&&function(t){s.d(e,t,(function(){return i[t]}))}(n);s("94f3");var r=s("2877"),o=Object(r["a"])(i["default"],a["a"],a["b"],!1,null,"04056ddc",null);e["default"]=o.exports},cb54:function(t,e,s){s("a9e3"),s("b680"),Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0;var a=s("1aec"),i={props:{value:{type:Boolean,default:!1},patchId:{type:[String,Number],required:!0},currentStep:{type:[String,Number]}},data:function(){return{step:0,prevStep:0,message:"",num:0,timer:null,percentTimer:null,duration:1500,download:{download_page:0,download_total_page:1},loading:!1,stage:0,lastMessage:""}},watch:{value:function(t){t&&(this.init(),this.currentStep&&(this.step=this.currentStep,31==this.step?(this.num=100,this.stage=2):200==this.step?(this.num=100,this.stage=4):(this.loading=!0,this.startProgress())))}},methods:{fnCloseModal:function(){this.clear(),this.$emit("on-step-change",this.step),this.$emit("input",!1)},handleSuccess:function(){this.$emit("input",!1),this.$emit("on-success"),this.$Message.success("站点升级完成")},startUpgrade:function(){var t=this,e=arguments.length>0&&void 0!==arguments[0]&&arguments[0];this.loading=!0;var s={patch_id:this.patchId};e&&(s.is_reset=1),(0,a.startUpgrade)(s).then((function(e){0===e.error?(t.startProgress(),t.setStage(1)):191300===e.error?t.resetUpgrade():t.loading=!1}))},startProgress:function(){var t=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];this.init(t),this.getUpgradeStatus(),this.increment()},init:function(){var t=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];t&&(this.stage=0),this.step=0,this.prevStep=0,this.message="",this.num=0,this.duration=200},clear:function(){this.loading=!1,clearTimeout(this.timer),clearTimeout(this.percentTimer)},setStage:function(t){this.stage=t},handleError:function(t){var e=t.error,s=t.step;return 0==e||(this.clear(),this.setStage(s>0?-2:-1),!1)},getUpgradeStatus:function(){var t=this;(0,a.getUpgradeStatus)().then((function(e){var s=e.error,a=e.message,i=e.step,n=e.download_page,r=e.download_total_page;t.handleError({error:s,step:i})&&(t.prevStep=t.step,t.step=i,31==i||200==i?t.lastMessage=a:t.message=a,31==t.step||200==t.step?(t.duration=100,clearTimeout(t.timer)):(t.download={download_page:n,download_total_page:r},t.timer=setTimeout((function(){t.getUpgradeStatus()}),1500)))}))},increment:function(){var t=this;if(this.num+1>=100&&(this.num=100,clearTimeout(this.percentTimer),this.loading=!1,31==this.step?this.stage=2:this.stage=4,this.message=this.lastMessage),30==this.step){var e=this.download,s=e.download_page,a=e.download_total_page;if(a){var i=20+parseFloat(s/a*60);this.num=+parseFloat(i).toFixed(2)}this.duration=500}else this.num<this.getLimitPercent(this.step)&&this.num++;this.percentTimer=setTimeout((function(){clearTimeout(t.percentTimer),t.increment()}),this.duration)},getLimitPercent:function(t){switch(t){case 20:return 20;case 30:return 80;case 31:return 100;case 40:return 20;case 41:return 40;case 42:return 60;case 43:return 80;case 200:return 100;default:break}return 0},resetUpgrade:function(){this.startUpgrade(!0)},execute:function(){var t=this;this.clear(),this.loading=!0,(0,a.executeUpgrade)().then((function(e){0==e.error?(t.startProgress(!1),t.setStage(3)):t.setStage(-1),t.timer=setTimeout((function(){t.loading=!1}),1e3)}))}},beforeDestroy:function(){this.clear()}};e.default=i},ccb5:function(t,e,s){function a(t,e){if(null==t)return{};var s,a,i={},n=Object.keys(t);for(a=0;a<n.length;a++)s=n[a],e.indexOf(s)>=0||(i[s]=t[s]);return i}s("c975"),s("b64b"),Object.defineProperty(e,"__esModule",{value:!0}),e.default=a},f038:function(t,e,s){"use strict";s.d(e,"a",(function(){return a})),s.d(e,"b",(function(){return i}));var a=function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("div",{directives:[{name:"show",rawName:"v-show",value:t.value,expression:"value"}],staticClass:"modal",on:{click:function(t){t.stopPropagation()}}},[s("div",{staticClass:"modal-mask"}),s("div",{staticClass:"modal-content"},[s("div",{staticClass:"close",on:{click:t.fnCloseModal}},[s("Icon",{attrs:{type:"ios-close",size:24}})],1),0===t.stage?s("div",{staticClass:"icon iconfont icon-xitong-sousuo"}):-1==t.stage||-2==t.stage?s("div",{staticClass:"icon iconfont icon-del"}):4==t.stage?s("div",{staticClass:"icon iconfont icon-yes"}):s("svg-icon",{staticClass:"icon iconfont",attrs:{type:"icon-xitong-xiufu"}}),s("div",{staticClass:"tips"},[0==t.stage?s("span",[t._v("是否要进行系统升级")]):-1==t.stage||-2==t.stage?s("span",[t._v("系统升级失败")]):1==t.stage||3==t.stage?s("span",[t._v("正在升级系统")]):2==t.stage?s("span",[t._v("升级包准备完成")]):4==t.stage?s("span",[t._v("升级完成")]):t._e(),t.step>0?s("span",{staticClass:"percent"},[t._v(t._s(t.num)+"%")]):t._e()]),s("div",{staticClass:"check"},[t.step>0?s("div",{staticClass:"progress"},[s("div",{staticClass:"bg"},[s("div",{staticClass:"current",style:"width: "+t.num+"%;"})])]):t._e(),t.message?s("hint-text",{staticStyle:{"text-align":"center"}},[t._v(t._s(t.message))]):t._e()],1),0==t.stage?s("div",{staticClass:"btn-wrap"},[s("div",{staticClass:"type type1"},[s("Button",{attrs:{type:"primary"},on:{click:t.startUpgrade}},[t._v("开始")]),s("Button",{on:{click:t.fnCloseModal}},[t._v("取消")])],1)]):2==t.stage?s("div",{staticClass:"btn-wrap"},[s("div",{staticClass:"type type2"},[s("Button",{attrs:{type:"primary",loading:t.loading,long:!0},on:{click:t.execute}},[t._v(" 立即升级 ")])],1)]):4==t.stage?s("div",{staticClass:"btn-wrap"},[s("div",{staticClass:"type type2"},[s("Button",{attrs:{type:"primary",long:!0},on:{click:t.handleSuccess}},[t._v(" 完成 ")])],1)]):s("div",{staticClass:"btn-wrap"},[s("div",{staticClass:"type type2"},[s("Button",{attrs:{type:"primary",disabled:-2==t.stage,long:"",loading:t.loading},on:{click:t.resetUpgrade}},[t._v("重新升级")])],1)])],1)])},i=[]},fe61:function(t,e,s){var a=s("4ea4");s("99af"),s("d81d"),Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0;var i=a(s("5530")),n=a(s("2909")),r=a(s("15fd")),o=a(s("804d")),c=s("1aec"),u={components:{CommonModal:o.default},data:function(){return{updateLogs:[],local_version:{is_latest:!0},versionInfo:{version:""},modalShowFlag:!1,loading:!1,latest_upgrade_time:""}},computed:{isVersionInfoLogs:function(){var t;return null===(t=this.updateLogs)||void 0===t?void 0:t.length}},created:function(){this.upgradeInit()},methods:{upgradeInit:function(){var t=this;(0,c.getUpgradeInfo)().then((function(e){if(0===e.error){var s=e.latest_version,a=void 0===s?{}:s,o=e.local_version,c=void 0===o?{}:o,u=e.step,d=e.latest_upgrade_time,l=a.logs_add,p=void 0===l?[]:l,g=a.logs_optimize,f=void 0===g?[]:g,v=a.logs_repair,m=void 0===v?[]:v,h=(0,r.default)(a,["logs_add","logs_optimize","logs_repair"]);p=p.map((function(t){return{type:"新增",content:t}})),f=f.map((function(t){return{type:"优化",content:t}})),m=m.map((function(t){return{type:"修复",content:t}})),t.updateLogs=[].concat((0,n.default)(p),(0,n.default)(f),(0,n.default)(m)),t.versionInfo=(0,i.default)((0,i.default)({},h),{},{step:u}),t.local_version=c,t.latest_upgrade_time=d}}))},startUpgrade:function(){this.modalShowFlag=!0},stepChange:function(t){this.versionInfo.step=t}}};e.default=u}}]);