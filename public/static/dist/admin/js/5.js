(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([[5],{"02d1":function(t,e,a){"use strict";a.r(e);var n=a("2fd9"),s=a.n(n);for(var i in n)"default"!==i&&function(t){a.d(e,t,(function(){return n[t]}))}(i);e["default"]=s.a},"0b2e":function(t,e,a){var n=a("4ea4");a("ac1f"),a("841c"),Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0;var s=n(a("5530")),i=n(a("2b73")),r=n(a("0e5f")),o=n(a("b66a")),l=a("a800"),c={components:{SearchHeader:i.default,TableList:r.default,CommonModal:o.default},data:function(){return{search:{},tab:"all",categoryList:[],table:{data:[],total:0,loading:!1},sort:{},page:{pageSize:10,pageNumber:1},modalShowFlag:!1,modalLoading:!1,appData:{},step:"0",errMsg:""}},created:function(){this.isJumpIn(),this.getList()},methods:{tabClick:function(t){this.tab=t,this.refreshTable()},getList:function(){var t=this;this.table.loading=!0;var e=Object.assign({pagesize:this.page.pageSize,page:this.page.pageNumber,category:"-100"},this.search,this.sort);(0,l.getAppsList)(e).then((function(e){t.table.loading=!1,0===e.error&&(t.table.data=e.list,t.table.total=e.total)}))},refreshTable:function(){this.page={pageSize:10,pageNumber:1},this.$refs["table_list"].reset(),this.getList()},handleSearch:function(t){this.search=t,this.refreshTable()},changePage:function(t){this.page=t,this.getList()},handleSort:function(t){this.sort=t,this.refreshTable()},handleInstall:function(t){this.appData=(0,s.default)({},t),this.modalShowFlag=!0},checkAppInstall:function(){var t=this;this.modalLoading=!0;var e=this.appData,a=e.identity,n=e.app_id;this.step="1",(0,l.checkAppInstall)({identity:a,app_id:n}).then((function(e){0===e.error?t.requestAppInstall():(t.step="6",t.errMsg=e.message,t.modalLoading=!1)}))},requestAppInstall:function(){var t=this;this.step="2",(0,l.requestAppInstall)().then((function(e){0===e.error?t.getRequestStatus():(t.step="6",t.errMsg=e.message,t.modalLoading=!1)}))},getRequestStatus:function(){var t=this;(0,l.getRequestStatus)().then((function(e){0===e.error?e.packaged?t.downloadFile():setTimeout((function(){t.getRequestStatus()}),2e3):(t.step="6",t.errMsg=e.message,t.modalLoading=!1)}))},downloadFile:function(){var t=this;this.step="3";var e=1,a=function e(a){(0,l.downloadFile)({page:a}).then((function(n){0===n.error?n.is_end?t.execute():(a++,e(a)):(t.step="6",t.errMsg=n.message,t.modalLoading=!1)}))};a(e)},execute:function(){var t=this;this.step="4",(0,l.execute)().then((function(e){0===e.error?(t.step="5",t.modalLoading=!1):(t.step="6",t.errMsg=e.message,t.modalLoading=!1)}))},refreshData:function(){this.refreshTable()},isJumpIn:function(){this.$route.query.appName&&(this.search.keywords=this.$route.query.appName)}}};e.default=c},"0e5f":function(t,e,a){"use strict";a.r(e);var n=a("491e"),s=a("f1a1");for(var i in s)"default"!==i&&function(t){a.d(e,t,(function(){return s[t]}))}(i);a("db7f");var r=a("2877"),o=Object(r["a"])(s["default"],n["a"],n["b"],!1,null,"44a95440",null);e["default"]=o.exports},"161d":function(t,e,a){},"1d9a":function(t,e,a){a("a4d3"),a("e01a"),a("99af"),a("b0c0"),a("a9e3"),Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0;var n={name:"TableList",props:{data:{type:Array,default:function(){return[]}},total:{type:[String,Number],default:0},loading:{type:Boolean,default:!1},category:{type:[String,Number],default:"all"}},data:function(){var t=this;this.$createElement;return{isSelectAll:!1,columns:[{title:"应用名称",key:"name",minWidth:150,render:function(e,a){return e("div",{class:"app-name"},[e("div",{class:"image"},[e("img",{attrs:{src:t.$utils.media(a.row.logo)},on:{error:function(e){return t.$utils.replaceImage(e,"shop")}}})]),e("div",{class:"name-box"},[e("div",{class:"name"},[a.row.name]),e("div",{class:"intro"},[a.row.description])])])}},{title:"更新时间",slot:"action"},{title:"操作",slot:"action",width:240}],appSettings:{notice:{path:"/app/app/notice",settingsTab:"package"},goodsHelper:{path:"/app/app/goods-helper",settingsTab:"package"}}}},methods:{changePage:function(t){this.$emit("on-page-change",t)},reset:function(){var t;null===(t=this.$refs["page"])||void 0===t||t.reset()},changeSort:function(t){var e=t.key,a=t.order;"normal"===a?this.$emit("on-sort",{}):this.$emit("on-sort",{sort:e,by:a})},handleInstall:function(t){this.$emit("on-install",{identity:t.identity,app_id:t.id,logo:t.logo,name:t.name})},editConfig:function(t){var e="/app/app/config?id=".concat(t.id,"&type=").concat(t.identity);"assistant"===t.identity&&(e="/app/app/shop-assistant?id=".concat(t.id)),this.$router.push({path:e})},handleSetting:function(t){var e=this.appSettings[t.identity],a=e.path,n=e.settingsTab;this.$router.push({path:a,query:{tab:n,id:t.id}})}}};e.default=n},"248b":function(t,e,a){"use strict";a.r(e);var n=a("0b2e"),s=a.n(n);for(var i in n)"default"!==i&&function(t){a.d(e,t,(function(){return n[t]}))}(i);e["default"]=s.a},"29fa":function(t,e,a){"use strict";a.r(e);var n=a("6654"),s=a("248b");for(var i in s)"default"!==i&&function(t){a.d(e,t,(function(){return s[t]}))}(i);a("cf89");var r=a("2877"),o=Object(r["a"])(s["default"],n["a"],n["b"],!1,null,"1979ba20",null);e["default"]=o.exports},"2b73":function(t,e,a){"use strict";a.r(e);var n=a("a621"),s=a("fea1");for(var i in s)"default"!==i&&function(t){a.d(e,t,(function(){return s[t]}))}(i);a("a628");var r=a("2877"),o=Object(r["a"])(s["default"],n["a"],n["b"],!1,null,"320c3d6a",null);e["default"]=o.exports},"2fd9":function(t,e,a){a("b680"),Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0;var n=a("a800"),s={props:["type","value","appData"],data:function(){return{step:0,prevStep:0,message:"",status:"active",installPercent:0,timer:null,percentTimer:null,duration:1500,download:{download_page:0,download_total_page:1},loading:!1,isPending:!1}},watch:{value:function(t){t&&this.init()}},computed:{typeText:function(){return"shop"==this.type?"":"应用"}},methods:{fnCloseModal:function(){this.$emit("input",!1)},startInstallApp:function(){var t,e,a=this;this.loading=!0;var s={identity:null===(t=this.appData)||void 0===t?void 0:t.identity,app_id:null===(e=this.appData)||void 0===e?void 0:e.app_id};(0,n.startInstallApp)(s).then((function(t){0===t.error?a.startProgress():191300===t.error?a.resetUpgrade():a.loading=!1}))},startProgress:function(){this.init(),this.getAppStatus(),this.increment()},init:function(){this.step=0,this.prevStep=0,this.message="",this.installPercent=0,this.status="active",this.duration=200},clear:function(){this.loading=!1,clearTimeout(this.timer),clearTimeout(this.percentTimer)},getAppStatus:function(){var t=this;(0,n.getAppStatus)().then((function(e){var a=e.error,n=e.message,s=e.step,i=e.download_page,r=e.download_total_page;t.message=n,t.prevStep=t.step,t.step=s,-1==a?(t.fail(),t.clear(),s>0&&(t.isPending=!0)):-10002===a?(clearTimeout(t.timer),t.clear()):200!=t.step?(t.download={download_page:i,download_total_page:r},t.timer=setTimeout((function(){t.getAppStatus()}),1500)):(t.duration=100,clearTimeout(t.timer))}))},fail:function(){this.status="wrong"},increment:function(){var t=this;if(this.installPercent+1>=100&&(this.installPercent=100,clearTimeout(this.percentTimer),this.loading=!1),30==this.step){var e=this.download,a=e.download_page,n=e.download_total_page;if(n){var s=20+parseFloat(a/n*60);this.installPercent=+parseFloat(s).toFixed(2)}this.duration=500}else this.installPercent<this.getLimitPercent(this.step)&&this.installPercent++;this.percentTimer=setTimeout((function(){clearTimeout(t.percentTimer),t.increment()}),this.duration)},getLimitPercent:function(t){switch(t){case 20:return 20;case 30:return 80;case 31:return 90;case 40:return 86;case 41:return 92;case 42:return 97;case 43:return 98;case 200:return 100;default:break}return 0},resetInstall:function(){this.startInstallApp({reset:1})},execute:function(){this.$emit("on-success"),this.$emit("input",!1)}}};e.default=s},"3ba7":function(t,e,a){"use strict";var n=a("87ee"),s=a.n(n);s.a},"3ffc":function(t,e){Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0;var a={props:["keywords"],data:function(){return{model:{keywords:"",status:"all"},statusList:[{id:"all",name:"全部"},{id:"0",name:"未上架"},{id:"1",name:"已上架"}]}},methods:{handleSearch:function(){var t=Object.assign({},this.model);t.status="all"===t.status?"":t.status,console.log(t),this.$emit("on-search",t)},handleReset:function(){this.model={keywords:"",status:"all"},this.$emit("on-search",{})}}};e.default=a},"491e":function(t,e,a){"use strict";a.d(e,"a",(function(){return n})),a.d(e,"b",(function(){return s}));var n=function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("div",{staticClass:"app-table-list"},[a("Table",{directives:[{name:"loading",rawName:"v-loading",value:t.loading,expression:"loading"}],ref:"table",attrs:{columns:t.columns,data:t.data},on:{"on-sort-change":t.changeSort},scopedSlots:t._u([{key:"action",fn:function(e){var n=e.row;return[a("div",{staticClass:"action"},[a("Button",{attrs:{type:"text",disabled:!n.can_install},on:{click:function(e){return t.handleInstall(n)}}},[t._v(" "+t._s(n.can_install?"立即安装":n.install_limit_text)+" ")])],1)]}}])}),a("div",{directives:[{name:"show",rawName:"v-show",value:t.total>10,expression:"total > 10"}],staticClass:"footer-page"},[a("page-component",{ref:"page",attrs:{total:t.total},on:{"on-change":t.changePage}})],1)],1)},s=[]},6654:function(t,e,a){"use strict";a.d(e,"a",(function(){return n})),a.d(e,"b",(function(){return s}));var n=function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("div",{staticClass:"app"},[a("search-header",{on:{"on-search":t.handleSearch}}),a("div",{staticClass:"app-content"},[a("ul",{staticClass:"app-content-tab"},t._l(t.categoryList,(function(e){return a("li",{key:e.value,class:{active:t.tab===e.value},on:{click:function(a){return t.tabClick(e.value)}}},[t._v(" "+t._s(e.title)+" "),a("div",{staticClass:"active-line"})])})),0),a("div",{staticClass:"table-list"},[a("table-list",{ref:"table_list",attrs:{data:t.table.data,total:t.table.total,loading:t.table.loading,category:t.tab},on:{"on-page-change":t.changePage,"on-sort":t.handleSort,"on-install":t.handleInstall}})],1)]),a("common-modal",{attrs:{loading:t.modalLoading,appData:t.appData},on:{"on-success":t.refreshData},model:{value:t.modalShowFlag,callback:function(e){t.modalShowFlag=e},expression:"modalShowFlag"}})],1)},s=[]},"87ee":function(t,e,a){},"9e31":function(t,e,a){"use strict";a.d(e,"a",(function(){return n})),a.d(e,"b",(function(){return s}));var n=function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("div",{directives:[{name:"show",rawName:"v-show",value:t.value,expression:"value"}],staticClass:"modal",on:{click:function(t){t.stopPropagation()}}},[a("div",{staticClass:"modal-mask"}),a("div",{staticClass:"modal-content"},[t.loading?t._e():a("div",{staticClass:"close",on:{click:t.fnCloseModal}},[a("Icon",{attrs:{type:"ios-close",size:24}})],1),a("div",{staticClass:"logo"},[a("img",{attrs:{src:t.$utils.media(t.appData.logo),alt:""},on:{error:function(e){return t.$utils.replaceImage(e)}}})]),a("div",{staticClass:"tips"},[0==t.step?a("span",[t._v("是否要安装"+t._s(t.appData.name)+t._s("shop"==t.type?"店铺类型":"应用"))]):"wrong"==t.status?a("span",[t._v("正在安装"+t._s(t.typeText))]):t.step>0&&100!=t.installPercent?a("span",[t._v("正在安装"+t._s(t.typeText)+" "+t._s(t.installPercent)+"%")]):100==t.installPercent?a("span",[t._v(t._s(t.typeText)+"安装完成")]):t._e()]),a("div",{staticClass:"check"},[t.step>0?a("div",{staticClass:"progress"},[a("div",{staticClass:"bg"},[a("div",{staticClass:"current",style:"width: "+t.installPercent+"%;"})])]):t._e(),t.message?a("hint-text",{staticStyle:{"text-align":"center"}},[t._v(t._s(t.message))]):t._e()],1),100==t.installPercent?a("div",{staticClass:"btn-wrap"},[a("div",{staticClass:"type type2"},[a("Button",{attrs:{type:"primary",loading:t.loading,long:!0},on:{click:t.execute}},[t._v(" 确定 ")])],1)]):0!=t.step?a("div",{staticClass:"btn-wrap"},[a("div",{staticClass:"type type2"},[a("Button",{attrs:{type:"primary",long:"",disabled:t.isPending,loading:t.loading},on:{click:t.resetInstall}},[t._v("重新安装")])],1)]):a("div",{staticClass:"btn-wrap"},[0==t.step?a("div",{staticClass:"type type1"},[a("Button",{attrs:{type:"primary",loading:t.loading},on:{click:t.startInstallApp}},[t._v("开始安装")]),a("Button",{on:{click:t.fnCloseModal}},[t._v("取消")])],1):t._e()])])])},s=[]},"9f05":function(t,e,a){},a621:function(t,e,a){"use strict";a.d(e,"a",(function(){return n})),a.d(e,"b",(function(){return s}));var n=function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("div",{staticClass:"header"},[a("div",{staticClass:"flex"},[a("Form",{ref:"form",attrs:{model:t.model,"label-width":100,inline:""},nativeOn:{submit:function(t){t.preventDefault()}}},[a("FormItem",{attrs:{label:"应用名称："}},[a("Input",{staticClass:"width-340",attrs:{type:"text",placeholder:"应用名称"},on:{"on-enter":t.handleSearch},model:{value:t.model.keywords,callback:function(e){t.$set(t.model,"keywords",e)},expression:"model.keywords"}})],1)],1),a("div",{staticClass:"btn"},[a("Button",{staticClass:"mL-20",attrs:{type:"primary"},on:{click:t.handleSearch}},[t._v("搜索")]),a("Button",{staticClass:"mL-20",attrs:{type:"text"},on:{click:t.handleReset}},[t._v("重置")])],1)],1)])},s=[]},a628:function(t,e,a){"use strict";var n=a("9f05"),s=a.n(n);s.a},a800:function(t,e,a){Object.defineProperty(e,"__esModule",{value:!0}),e.getAppStatus=e.startInstallApp=e.execute=e.downloadFile=e.getRequestStatus=e.requestAppInstall=e.checkAppInstall=e.getAppsList=void 0;var n=a("66df"),s=function(t){return(0,n.get)("admin/apps/index/get-list",t)};e.getAppsList=s;var i=function(t){return(0,n.post)("admin/system/app-install/check",t)};e.checkAppInstall=i;var r=function(t){return(0,n.post)("admin/system/app-install/request",t)};e.requestAppInstall=r;var o=function(t){return(0,n.get)("admin/system/app-install/get-request-status",t)};e.getRequestStatus=o;var l=function(t){return(0,n.get)("admin/system/app-install/download-file",t)};e.downloadFile=l;var c=function(t){return(0,n.post)("admin/system/app-install/execute",t)};e.execute=c;var u=function(t){return(0,n.post)("system/app-install-new/start",t)};e.startInstallApp=u;var d=function(t){return(0,n.get)("system/app-install-new/get-status",t)};e.getAppStatus=d},afde:function(t,e,a){},b66a:function(t,e,a){"use strict";a.r(e);var n=a("9e31"),s=a("02d1");for(var i in s)"default"!==i&&function(t){a.d(e,t,(function(){return s[t]}))}(i);a("3ba7");var r=a("2877"),o=Object(r["a"])(s["default"],n["a"],n["b"],!1,null,"f35f90e0",null);e["default"]=o.exports},cf89:function(t,e,a){"use strict";var n=a("afde"),s=a.n(n);s.a},db7f:function(t,e,a){"use strict";var n=a("161d"),s=a.n(n);s.a},f1a1:function(t,e,a){"use strict";a.r(e);var n=a("1d9a"),s=a.n(n);for(var i in n)"default"!==i&&function(t){a.d(e,t,(function(){return n[t]}))}(i);e["default"]=s.a},fea1:function(t,e,a){"use strict";a.r(e);var n=a("3ffc"),s=a.n(n);for(var i in n)"default"!==i&&function(t){a.d(e,t,(function(){return n[t]}))}(i);e["default"]=s.a}}]);