(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([[107],{"05a58":function(e,t,n){"use strict";n.d(t,"a",(function(){return a})),n.d(t,"b",(function(){return o}));var a=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",{directives:[{name:"loading",rawName:"v-loading",value:{loading:e.loading,title:e.spinTitle},expression:"{\n        loading,\n        title:spinTitle\n    }"}],staticClass:"decorate-index"},[1001!=e.tabId?a("oper-panel"):e._e(),a("div",{staticClass:"phone-area"},[a("div",{staticClass:"scroll-body"},[a("diy-phone",{attrs:{bgImg:"diymenu"==e.pageId?e.menuBg:""},scopedSlots:e._u([{key:"top",fn:function(){return e._l(e.topItem,(function(t,n){return a("drag-item-box",{key:n,staticClass:"lazy-load-box",class:t?t.id:"",attrs:{item:t}},[a(e.getComponentName(t),{tag:"component",attrs:{"component-data":t}})],1)}))},proxy:!0},e.getBottomItem.length?{key:"bottom",fn:function(){return e._l(e.getBottomItem(e.bottomItem),(function(t,n){return a("drag-item-box",{key:t._comIndex_||n,class:t?t.id:"",attrs:{item:t}},[a(e.getComponentName(t),{tag:"component",attrs:{"component-data":t}})],1)}))},proxy:!0}:null,e.fixedItem.length?{key:"fixed",fn:function(){return e._l(e.filterAdvs(e.fixedItem),(function(t,n){return a("float-item-box",{key:t._comIndex_||n,staticClass:"fixed-item",class:t?t.id:"",attrs:{item:t}},[a(e.getComponentName(t),{tag:"component",attrs:{"component-data":t}})],1)}))},proxy:!0}:null],null,!0)},e._l(e.getSortableList,(function(t,n){return a("drag-item-box",{key:t._comIndex_||n,staticClass:"lazy-load-box",class:""+(t?t.id:""),attrs:{"lazy-update":e.showElesPort[n+e.topItem.length]||!1,item:t},on:{beforeChange:e.beforeChange}},[a("keep-alive",[a(e.getComponentName(t),{directives:[{name:"show",rawName:"v-show",value:!0,expression:"true||filteComponent[item._comIndex_]!==false"}],tag:"component",attrs:{id:t._comIndex_||n,"component-data":t,"start-load-img":e.showElesPort[n+e.topItem.length]||!1}})],1)],1)})),1)],1),1001===e.tabId||e.onlyOne?e._e():a("quick-actions")],1),a("component-setter",{ref:"componentSetter"}),a("bottom-bar",{staticStyle:{"z-index":"1000"},attrs:{loading:e.loading,backing:e.isAutoBack},on:{click:e.toSave,clickTab:e.clickTab}}),a("Drawer",{staticClass:"modal-drawer",attrs:{width:"500",closable:!1},on:{"on-visible-change":e.closePreview},model:{value:e.previewPage,callback:function(t){e.previewPage=t},expression:"previewPage"}},[a("Card",{staticClass:"modal-title"},[a("p",{staticClass:"title",attrs:{slot:"title"},slot:"title"},[a("span",[e._v("页面预览")])]),a("div",{staticClass:"phone-bg"},[a("img",{attrs:{src:n("75df"),alt:""}}),a("div",{staticClass:"iframe"},[e.previewPage?a("iframe",{key:e.previewUrl,attrs:{src:e.previewUrl,frameborder:"0",width:"326",height:"714",id:"iframe"}}):e._e()])])])],1),a("TmpSaveModal",{ref:"tmpSaveModal"}),e._t("default")],2)},o=[]},"065f5":function(e,t,n){var a=n("4ea4").default;Object.defineProperty(t,"__esModule",{value:!0}),t.getter=c,t.setter=p;var o=a(n("15fd"));n("498a"),n("b0c0"),n("e9c4");var i=a(n("53ca")),r=n("b428"),s=n("3fdc"),d=["name"],l=["name","app_type"];function u(e){if("object"==(0,i.default)(e))for(var t in e)"string"==typeof e[t]?e[t]=e[t].trim():"object"==(0,i.default)(e[t])&&u(e[t]);return e}function c(e){var t=this,n=(e.pageId,e.type),a=e.tplId;"edit"==n&&this.$api.decorateApi.getNewDiyMenuDetail({id:a}).then((function(e){if("0"==e.error){var n=e.data,a=n.name,o=n.content,i=(0,s.deepCopy)(r.diymenu);i.items=[],i.name=a,e=(0,s.deepMerge)(i,JSON.parse(o)),e.style.bordertopcolor=e.style.bordertopcolor||"#eeeeee",e.id="diymenu",e.type="diymenu",e.isbottom=3,e=u(e),t.$nextTick((function(){Object.assign(t.pageList[0],e),t.pageInfo.title=e.name,t.refreshCurrentModal(),t.refreshPageInfo()}))}}))}function p(e){e.pageId;var t=e.type,n=e.tplId,a=e.action,i=e.previewImage;if("edit"==t){var r=this.currentModal,s=r.name,u=(0,o.default)(r,d),c={id:n,name:s,content:JSON.stringify(u),thumb:i};return"publish"===a&&(c.status="1"),this.$api.decorateApi.updateNewDiyMenu(c)}var p=this.currentModal,f=p.name,m=p.app_type,g=(0,o.default)(p,l),h={id:void 0,name:f,type:m,content:JSON.stringify(g),thumb:i};return"publish"===a&&(h.status="1"),this.$api.decorateApi.createNewDiyMenu(h)}},"238e":function(e,t,n){"use strict";n("75a6")},"2cf5":function(e,t,n){var a=n("4ea4").default;Object.defineProperty(t,"__esModule",{value:!0}),t.ViewPort=void 0;var o=a(n("d4ec")),i=a(n("bee2")),r=function(){function e(t){var n=this;(0,o.default)(this,e),this.viewport=null,this.viewportEle=null,this.eleList=[],this.portList=[],this.callback=null;var a=null;this.getViewPort(),this.callback=t,window.addEventListener("resize",(function(){n.getViewPort(),t(n.getViewableEles())})),document.getElementsByClassName("phone-area")[0].onscroll=function(){clearTimeout(a),a=setTimeout((function(){n.throttle=null,n.getViewPort(),n.getViewableEles()}),500)}}return(0,i.default)(e,[{key:"getViewPort",value:function(){return this.viewportEle=this.viewportEle||document.getElementsByClassName("phone-area")[0],this.viewport={top:this.viewportEle.scrollTop,bottom:this.viewportEle.scrollTop+this.viewportEle.clientHeight},this}},{key:"getEleScrollHeight",value:function(){this.eleList=document.getElementsByClassName("lazy-load-box");var e=this.eleList.length,t=null;this.portList=[];for(var n=0;n<e;n++)t=this.eleList[n],this.portList.push({top:t.offsetTop,bottom:t.offsetTop+t.clientHeight});return this}},{key:"getViewableEles",value:function(){var e=this.portList;e.length||(e=this.getEleScrollHeight());for(var t=e.length,n=null,a=0,o=0,i=0;i<t;i++)if(n=e[i],(n.top==this.viewport.top||n.top<this.viewport.top&&n.bottom>=this.viewport.top)&&(a=i),o=i,n.top<this.viewport.bottom&&n.bottom>=this.viewport.bottom||n.bottom==this.viewport.bottom)break;if(this.callback){for(var r={},s=a;s<=o;s++)r[s]=!0;this.callback(r)}return this}}]),e}();t.ViewPort=r},"4aa8":function(e,t,n){var a=n("dbce").default,o=n("4ea4").default;Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0,n("d3b7"),n("3ca3"),n("ddb0"),n("fb6a"),n("4de4"),n("ac1f"),n("5319");var i=o(n("c7eb")),r=o(n("1da1")),s=o(n("5530")),d=n("8875"),l=o(n("a743")),u=n("2f62"),c=n("c038"),p=a(n("7d1a")),f=n("2cf5"),m={index:10,"goods-detail":11,"vip-center":12,distribution:20},g={data:function(){return{lazyLoadList:[],nextItem:{},loading:!1,key:0,previewPage:!1,tabId:"",currentItem:{},spinTitle:"",previewId:"",isAutoBack:!1,previewImage:"",pageId:"",menuBg:n("920b"),showElesPort:{}}},updated:function(){var e=this;clearTimeout(this.throttle),this.throttle=setTimeout((function(){e.$nextTick((function(){e.viewPorter&&e.viewPorter.getViewPort().getEleScrollHeight().getViewableEles()}))}),100)},components:(0,s.default)((0,s.default)({},d.pageComponents),{},{OthersPanel:function(){return n.e(166).then(n.bind(null,"3a90"))},QuickActions:function(){return n.e(164).then(n.bind(null,"c132"))},OperPanel:function(){return n.e(163).then(n.bind(null,"f85f"))},DiyPhone:function(){return n.e(111).then(n.bind(null,"d1e6"))},BottomBar:function(){return n.e(169).then(n.bind(null,"e0ca"))},ComponentSetter:l.default,TmpSaveModal:function(){return n.e(24).then(n.bind(null,"2b4b"))},DragItemBox:function(){return n.e(22).then(n.bind(null,"df776"))},FloatItemBox:function(){return n.e(25).then(n.bind(null,"11b3"))}}),computed:(0,s.default)((0,s.default)((0,s.default)({},(0,u.mapGetters)("decorate",["getModal","getAllModalName"])),(0,u.mapState)("decorate",{pageInfo:function(e){return e.pageInfo},pageList:function(e){return e.pageList},currentModal:function(e){return e.currentModal},sortAbleList:function(e){return e.sortAbleList},topItem:function(e){return e.topItem},bottomItem:function(e){return e.bottomItem},fixedItem:function(e){return e.fixedItem},html2canvasing:function(e){return e.html2canvasing},keyword:function(e){return e.filteComponentKeyword},onlyOne:function(e){return e.onlyOneComponent}})),{},{filteComponent:function(){return p.searchComponent(this.keyword,this.sortAbleList)},getSortableList:function(){return this.html2canvasing>0?this.sortAbleList.slice(0,this.html2canvasing):this.sortAbleList},previewUrl:function(){return p.previewUrl(this.$route.params.page,this.previewId)}}),watch:{$route:{deep:!0,handler:function(){0==this.$route.path.indexOf("/decorate/")&&window.location.reload()}}},methods:(0,s.default)((0,s.default)((0,s.default)({},(0,u.mapMutations)("decorate",["changeFocus","clear","setPageList","setPageInfo","refreshCurrentModal","refreshPageInfo","setHtml2canvasing"])),(0,u.mapActions)("decorate",["createPoster","checkForm","addModal","scrollTo"])),{},{filterAdvs:function(e){return e.filter((function(e){return"advs"!==e.id}))},beforeChange:function(e){this.$refs.componentSetter.getComponentName(e.type)},getPoster:function(){var e=this;return this.clickTmp(),new Promise((function(t,n){e.$nextTick((function(){e.createPoster(e.$route.params.page).then((function(e){t(e)})).catch((function(e){n(e)}))}))}))},clickTmp:function(e){p.clickTmp(this.$route.params.page,e)},getComponentName:function(e){var t=e.id||e.typeid;return"Tpl"+(null===t||void 0===t?void 0:t.replace(/^./,(function(e){return e.toUpperCase()})))},toSave:function(e,t){var n=this;return(0,r.default)((0,i.default)().mark((function a(){return(0,i.default)().wrap((function(a){while(1)switch(a.prev=a.next){case 0:if(a.prev=0,!n.loading){a.next=3;break}return a.abrupt("return");case 3:if("pageSet"!=e){a.next=6;break}return n.clickTmp(),a.abrupt("return");case 6:return n.spinTitle="正在校验数据格式...",n.loading=!0,a.next=10,n.checkForm(n.$route);case 10:n.setHtml2canvasing(),n.spinTitle="正在生成缩略图...",n.$nextTick((function(){"asTpl"==e?setTimeout((function(){n.getPoster().then((function(e){n.previewImage=e,n.$refs.tmpSaveModal.toggleModal(e).then((function(){n.$nextTick((function(){n.loading=!1}))})).catch((function(){n.loading=!1}))})).catch((function(e){console.log(e),n.$Message.error("生成缩略图失败"),n.loading=!1}))}),100):n.getPoster().then((function(a){n.spinTitle="数据正在保存中...",n.previewImage=a,c.setPage.call(n,t,a).then((function(t){0==t.error?(n.previewId=t.id,n.$Message.success("操作成功"),"asPage"==e?setTimeout((function(){n.replacePath()}),1e3):(n.loading=!1,n.previewPage=!0)):n.loading=!1})).catch((function(){n.loading=!1}))})).catch((function(e){console.log(e),n.loading=!1,n.$Message.error("生成缩略图失败")}))})),a.next=20;break;case 15:a.prev=15,a.t0=a["catch"](0),console.log(a.t0,"err"),n.loading=!1,a.t0.message&&n.$Message.error(a.t0.message);case 20:case"end":return a.stop()}}),a,null,[[0,15]])})))()},replacePath:function(){var e=this.$route.params.page;this.isAutoBack=!0,m[e]||0===m[e]?this.$router.replace({path:"/shop/list/system"}):"diymenu"==e?this.$router.replace({path:"/shop/custom-menu"}):this.$router.go(-1)},clickTab:function(e){this.tabId=e,this.clickTmp(this.currentItem)},getBottomItem:function(e){return e.filter((function(e){return e.type}))},closePreview:function(e){e||this.replacePath()}}),beforeRouteLeave:function(e,t,n){var a=this;this.isAutoBack?n():this.$Modal.confirm({title:"确定离开",content:"系统可能不会保存您所做的更改",onOk:function(){n()},onCancel:function(){a.isAutoBack=!1,n(!1)}})},mounted:function(){var e=this;this.viewPorter=new f.ViewPort((function(t){var n=(0,s.default)((0,s.default)({},e.showElesPort),t);e.$utils.deepCompare(n,e.showElesPort)||(e.showElesPort=n)})),window.onbeforeunload=function(){return"系统可能不会保存您所做的更改"};var t,n=this.$route.params.page;this.pageId=n,c.getPage.call(this,{pageId:n,type:this.$route.query.type,tplId:this.$route.query.id,options:t})},destroyed:function(){window.onbeforeunload=null,this.loading=!1,this.clear()}};t.default=g},"71d0":function(e,t,n){"use strict";n.r(t);var a=n("4aa8"),o=n.n(a);for(var i in a)["default"].indexOf(i)<0&&function(e){n.d(t,e,(function(){return a[e]}))}(i);t["default"]=o.a},"75a6":function(e,t,n){},"75df":function(e,t,n){e.exports=n.p+"static/dist/shop/img/phone-bg.png"},"7d1a":function(e,t,n){var a=n("dbce").default,o=n("4ea4").default;Object.defineProperty(t,"__esModule",{value:!0}),t.clickTmp=l,t.previewUrl=d,t.searchComponent=void 0,n("d3b7"),n("159b"),n("b0c0");var i=o(n("5530")),r=a(n("d1be")),s=o(n("4360"));function d(e,t){var n=s.default.state.setting.wap_url;switch(e){case"goods-detail":n=n+"/kdxGoods/detail/index?goods_id="+s.default.state.setting.randomGoodId;break;case"vip-center":n+="/kdxMember/index/index";break;case"distribution":n+="/kdxCommission/index/index";break}return r.addQueryParams(n,{previewId:t})}function l(e,t){t?s.default.commit("decorate/changeFocus",{item:t,pageId:e}):s.default.commit("decorate/changeFocus",{item:(0,i.default)((0,i.default)({},s.default.state.decorate.pageInfo),{},{params:{},style:{},data:[]}),pageId:e})}var u=function(e,t){var n={};return t.forEach((function(t){n[t._comIndex_]=!1,e?t.name.indexOf(e)>-1&&(n[t._comIndex_]=!0):n[t._comIndex_]=!0})),n};t.searchComponent=u},"920b":function(e,t,n){e.exports=n.p+"static/dist/shop/img/menu-skeleton.png"},c038:function(e,t,n){var a=n("4ea4").default,o=n("dbce").default;Object.defineProperty(t,"__esModule",{value:!0}),t.getPage=_,t.setPage=C;var i=a(n("c7eb")),r=a(n("1da1")),s=a(n("15fd")),d=a(n("2909")),l=a(n("5530"));n("d81d"),n("d3b7"),n("159b"),n("caad"),n("4de4"),n("e9c4"),n("b0c0"),n("d9e2");var u=a(n("365c")),c=a(n("4360")),p=n("b428"),f=o(n("d1be")),m=["common"],g=["name","template_id"],h={},v={index:10,"goods-detail":11,"vip-center":12,distribution:20},b={diymenu:n("065f5")},y={index:10,"vip-center":10,custom:0},w=["index","vip-center"];function I(){c.default.state.setting.randomGoodId||u.default.goodsApi.getGoodsRanId().then((function(e){0===e.error&&c.default.commit("setting/setRanGoodId",e.goods_id)}))}var k=function(e){return e.map((function(e){if("goods"===e.id)e.defaultData=[],e.params=(0,l.default)({},e.params);else if("tabbar"===e.id)e.data.forEach((function(e){e.goods.defaultData=[],e.goods.params=(0,l.default)({},e.goods.params)}));else if("richtext"===e.id){var t,n=null===(t=e.params)||void 0===t?void 0:t.content;n&&(n=f.delmedia(n),n=f.alterVideo(n),e.params.content=n)}return e}))},x=function(e,t,n,a){t?e.forEach((function(e){"diymenu"==e.type&&Object.assign(e,n)})):e.push(a||n)},P=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return new Promise((function(t,n){u.default.decorateApi.getNewMenuContent(e,{nomessage:!0}).then((function(e){t(e)}))}))};function _(e){var t=this,n=e.pageId,a=void 0===n?"":n,o=e.type,u=void 0===o?"":o,f=e.tplId,g=void 0===f?"":f;e.options;if(h={pageId:a,type:u,tplId:g},"goods-detail"==a&&I.call(this),g&&null!=v[a])"add"==u?(this.loading=!0,this.$api.shopApi.getTempContent({id:g}).then((function(e){if(0===e.error){var n=e.data.content;n=Array.isArray(JSON.parse(n))?T(JSON.parse(n)):[];var o=!1,i=!1,r=n.map((function(e){var t=e.type,n=e.id;return"goods"===t?(e.defaultData=[],e.params=(0,l.default)({},e.params),e.params.goodsdata="0",e.data.forEach((function(e){e.isFrom="tpl_"+g})),e.tpl_data=e.data,e.data=[]):"tabbar"===e.id?e.data.forEach((function(e){e.goods&&(e.goods.defaultData=[],e.goods.params=(0,l.default)({},e.goods.params),e.goods.data.forEach((function(e){e.isFrom="tpl_"+g})),e.goods.tpl_data=e.goods.data,e.goods.data=[])})):"diymenu"==e.type&&(o=!0),"vip-center"==a&&"logout"==e.id&&(e.params.delable=!1,i=!0),(0,l.default)((0,l.default)({},e),{},{id:t,typeid:n})}));if("vip-center"==a&&!i&&r.push(p.logout),w.includes(a)){var s=y[a];P({type:s}).then((function(n){0==n.error?(n.content&&JSON.parse(n.content).id?x(r,o,JSON.parse(n.content)):x(r,o,JSON.parse(n.content),p.diymenu),N(t,r,(0,l.default)({pageId:a},e.data))):(o||r.push(p.diymenu),N(t,r,(0,l.default)({pageId:a},e.data)))}))}else N(t,r,(0,l.default)({pageId:a},e.data))}})).finally((function(){setTimeout((function(){t.loading=!1}),500)}))):(this.loading=!0,this.$api.decorateApi.getNewPageDetail({id:g,type:v[a]}).then((function(e){if(0===e.error){var n=e.data.content;n=Array.isArray(JSON.parse(n))?T(JSON.parse(n)):[],c.default.commit("decorate/setRecordPageList",(0,d.default)(n));var o=!1,i=n.map((function(e){var t=e.type,n=e.id;return"goods"===t?(e.defaultData=[],e.params=(0,l.default)({},e.params)):"tabbar"===t?e.data.forEach((function(e){var t,n;e.goods.defaultData=[],e.goods.params=(0,l.default)({},e.goods.params),e.goods.data=null!==(t=null===(n=e.goods.data)||void 0===n?void 0:n.filter((function(e){return e.id||e.gid})))&&void 0!==t?t:[]})):"diymenu"==t&&(o=!0),(0,l.default)((0,l.default)({},e),{},{id:t,typeid:n})}));if(w.includes(a)){var r=y[a];P({type:r}).then((function(n){if(0==n.error)n.content&&JSON.parse(n.content).id?x(i,o,JSON.parse(n.content)):x(i,o,JSON.parse(n.content),p.diymenu),N(t,i,(0,l.default)({pageId:a},e.data));else{var r=e.data,d=r.common,u=(0,s.default)(r,m);d=d?JSON.parse(d):{},N(t,i,(0,l.default)((0,l.default)({pageId:a},u),{},{common:JSON.stringify(d)}))}}))}else N(t,i,(0,l.default)({pageId:a},e.data))}})).finally((function(){setTimeout((function(){t.loading=!1}),500)})));else if(g||0!=v[a])b[a]?b[a].getter.call(this,{pageId:a,type:u,tplId:g}):this.setPageInfo({pageId:a,item:this.pageInfo});else{var k=y[a];P({type:k}).then(function(){var e=(0,r.default)((0,i.default)().mark((function e(n){var o,r;return(0,i.default)().wrap((function(e){while(1)switch(e.prev=e.next){case 0:0==n.error&&(o=[JSON.parse(n.content)],t.setPageList({list:o,pageId:a}),t.setPageInfo({pageId:a,item:t.pageInfo}),r&&c.default.commit("decorate/changeFocus",{item:r,pageId:a}));case 1:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}())}}function C(e,t){var n=h,a=n.pageId,o=void 0===a?"":a,i=n.type,r=void 0===i?"":i,d=n.tplId,l=void 0===d?"":d;if(null!=v[o]){var u,c=this.pageInfo,p=c.name,f=(c.template_id,(0,s.default)(c,g)),m=this.pageList;0===v[o]&&(m=m.filter((function(e){return"diymenu"!=e.type}))),f.page_name=p;var y={type:v[o],id:l,name:p,thumb:t,common:JSON.stringify(f),content:JSON.stringify(k(m))};return"edit"==r?u="updateNewPage":(u="createNewPage",y.id=void 0,y.template_id=l||0),"publish"===e&&(y.status="1"),this.$api.decorateApi[u](y)}return b[o]?b[o].setter.call(this,{pageId:o,type:r,tplId:l,action:e,previewImage:t}):new Promise((function(e,t){t(new Error("无此模板"))}))}var N=function(e,t,n){var a=n.pageId,o=n.common,i=n.name,r=n.thumb;o=o?JSON.parse(o):{};var s=o,d=s.title,l=s.keywords,u=s.background_color,c=s.desc,p=s.menu_name,f=s.menu_id,m=s.diy_menu,g=s.params;e.setPageList({list:t,pageId:a}),e.setPageInfo({pageId:a,item:{name:i,title:d,keywords:l,desc:c,thumb:r,background_color:u,diy_menu:m,params:g,menu_name:p,menu_id:f,id:"pageInfo"}})},T=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[];return e.map((function(e){if("richtext"===e.id){var t,n=null===(t=e.params)||void 0===t?void 0:t.content;n=f.richMedia(n),n=f.richMediaVideo(n),e.params.content=n}return e}))}},f098:function(e,t,n){"use strict";n.r(t);var a=n("05a58"),o=n("71d0");for(var i in o)["default"].indexOf(i)<0&&function(e){n.d(t,e,(function(){return o[e]}))}(i);n("238e");var r=n("2877"),s=Object(r["a"])(o["default"],a["a"],a["b"],!1,null,"0e67f50d",null);t["default"]=s.exports}}]);