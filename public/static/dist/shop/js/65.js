(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([[65],{"0232":function(t,e,a){var n=a("4ea4").default;Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0,a("ac1f"),a("841c"),a("d3b7"),a("159b");var i=n(a("5530")),s=n(a("2aed")),c=n(a("903f")),l={name:"index",components:{TableList:s.default,WechatEmpty:c.default},data:function(){return{search:{nickname:""},tab:"0",table:{list:[],total:0,loading:!1},page:{pageSize:10,pageNumber:1},tabList:[{id:"0",name:"粉丝"},{id:"1",name:"黑名单"}],loading:!1,isIdentifyService:!1,lastSyncTime:""}},created:function(){var t=this;this.$store.dispatch("channel/getWechatInfo").then((function(e){var a=e.isIdentifyService;t.isIdentifyService=a,a&&t.getList()}))},computed:{noManagePerm:function(){return!this.$getPermMap("channel.wechat.manage")}},methods:{tabClick:function(t){this.tab=t,this.handleRefresh()},syncFans:function(){var t=this;this.loading=!0,this.$api.homeApi.syncWechatFans().then((function(e){0===e.error?t.getTaskInfo(e.task_id):t.loading=!1}))},getTaskInfo:function(t){var e=this;this.$api.homeApi.getTaskInfo({task_id:t}).then((function(a){var n,i,s;0===a.error?0===+(null===(n=a.data)||void 0===n?void 0:n.status)?setTimeout((function(){e.getTaskInfo(t)}),3e3):1===+(null===(i=a.data)||void 0===i?void 0:i.status)?(e.$Message.success("同步成功"),e.handleRefresh(),e.loading=!1):2===+(null===(s=a.data)||void 0===s?void 0:s.status)?(e.$Message.error("同步失败"),e.loading=!1):e.loading=!1:e.loading=!1}))},getList:function(){var t=this;this.table.loading=!0;var e=(0,i.default)({pagesize:this.page.pageSize,page:this.page.pageNumber,is_black:"0"===this.tab?0:1},this.search);this.$api.homeApi.getWechatFansList(e).then((function(e){0===e.error&&(t.table.list=e.list||[],t.table.total=e.total,t.lastSyncTime=e.last_sync_time||"")})).finally((function(){t.table.loading=!1,t.$refs["table_list"].resetChecked()}))},handleRefresh:function(){this.resetPage(),this.getList()},handleSearch:function(){this.handleRefresh()},resetSearch:function(){this.search={nickname:""},this.handleRefresh()},changePage:function(t){this.page=t,this.getList()},resetPage:function(){this.page={pageSize:10,pageNumber:1},this.$refs["table_list"].resetPage()},changeCheckbox:function(t){var e=this;this.table.list.forEach((function(a,n){e.$set(e.table.list[n],"_checked",t)})),console.log("table-list",this.table.list)}}};e.default=l},"067a":function(t,e,a){},"1c67":function(t,e,a){"use strict";a.r(e);var n=a("8e14"),i=a.n(n);for(var s in n)["default"].indexOf(s)<0&&function(t){a.d(e,t,(function(){return n[t]}))}(s);e["default"]=i.a},"2aed":function(t,e,a){"use strict";a.r(e);var n=a("8386"),i=a("4028");for(var s in i)["default"].indexOf(s)<0&&function(t){a.d(e,t,(function(){return i[t]}))}(s);a("ac43");var c=a("2877"),l=Object(c["a"])(i["default"],n["a"],n["b"],!1,null,"2c80096a",null);e["default"]=l.exports},"2bd5":function(t,e,a){"use strict";a.d(e,"a",(function(){return n})),a.d(e,"b",(function(){return i}));var n=function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("kdx-modal-frame",{attrs:{title:"粉丝标签",width:500,loading:t.loading},on:{"on-cancel":t.setValue,"on-ok":t.handleOk},model:{value:t.value,callback:function(e){t.value=e},expression:"value"}},[a("div",{staticClass:"fans-label"},[a("div",{staticClass:"label-content"},t._l(t.list,(function(e,n){return a("div",{key:n,staticClass:"label-item",class:{checked:t.selectObj[e.wechat_tag_id]},on:{click:function(a){return t.selectLabel(e)}}},[a("span",[t._v(" "+t._s(e.tag_name))]),a("kdx-svg-icon",{staticClass:"icon",attrs:{type:"icon-chenggong-shixin"}})],1)})),0)])])},i=[]},"3b55":function(t,e,a){"use strict";a.r(e);var n=a("0232"),i=a.n(n);for(var s in n)["default"].indexOf(s)<0&&function(t){a.d(e,t,(function(){return n[t]}))}(s);e["default"]=i.a},4028:function(t,e,a){"use strict";a.r(e);var n=a("cdbd"),i=a.n(n);for(var s in n)["default"].indexOf(s)<0&&function(t){a.d(e,t,(function(){return n[t]}))}(s);e["default"]=i.a},7677:function(t,e,a){t.exports=a.p+"static/dist/shop/img/wechat-no-type.png"},"7ec6":function(t,e,a){"use strict";a.d(e,"a",(function(){return n})),a.d(e,"b",(function(){return i}));var n=function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("div",{directives:[{name:"loading",rawName:"v-loading",value:t.loading,expression:"loading"}],staticClass:"fans-list"},[a("kdx-header-bar",{attrs:{type:"little"},scopedSlots:t._u([{key:"header",fn:function(){return[a("div",{staticClass:"header-btn"},[a("Button",{attrs:{type:"primary",disabled:t.noManagePerm},on:{click:t.syncFans}},[t._v("同步所有粉丝")])],1)]},proxy:!0}])},[a("Form",{ref:"form",attrs:{"label-width":100,inline:""},nativeOn:{submit:function(t){t.preventDefault()}}},[a("FormItem",{attrs:{label:"粉丝信息："}},[a("Input",{staticClass:"width-172",attrs:{type:"text",placeholder:"请输入粉丝名称"},on:{"on-enter":t.handleSearch},model:{value:t.search.nickname,callback:function(e){t.$set(t.search,"nickname",e)},expression:"search.nickname"}})],1),a("div",{staticClass:"ivu-form-item-btn"},[a("Button",{attrs:{type:"primary"},on:{click:t.handleSearch}},[t._v("搜索")]),a("Button",{attrs:{type:"text"},on:{click:t.resetSearch}},[t._v("重置")])],1)],1)],1),a("div",{staticClass:"table-content"},[a("ul",{staticClass:"app-content-tab"},t._l(t.tabList,(function(e){return a("li",{key:e.id,class:{active:t.tab===e.id},on:{click:function(a){return t.tabClick(e.id)}}},[t._v(" "+t._s(e.name)+" "),a("div",{staticClass:"active-line"})])})),0),a("div",{staticClass:"sync-time"},[t._v(" 上次同步时间："),a("span",{staticClass:"time"},[t._v(t._s(t.lastSyncTime||"00-00-00 00:00:00"))])]),a("table-list",{ref:"table_list",attrs:{data:t.table.list,total:t.table.total,current:t.page.pageNumber,loading:t.table.loading,"page-size":t.page.pageSize,tab:t.tab},on:{"on-change-page":t.changePage,"on-refresh":t.handleRefresh,"on-checkbox":t.changeCheckbox}})],1),t.isIdentifyService?t._e():a("wechat-empty")],1)},i=[]},8386:function(t,e,a){"use strict";a.d(e,"a",(function(){return n})),a.d(e,"b",(function(){return i}));var n=function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("div",{directives:[{name:"loading",rawName:"v-loading",value:t.loading,expression:"loading"}],staticClass:"table-list"},[a("Table",{ref:"table",attrs:{columns:t.columns,data:t.data},on:{"on-selection-change":t.selectChange},scopedSlots:t._u([{key:"nickname",fn:function(e){var n=e.row;return[a("div",{staticClass:"nickname"},[a("div",{staticClass:"logo"},[a("img",{attrs:{src:t.$utils.media(n.avatar),alt:""},on:{error:function(e){return t.replaceImage("avatar")}}})]),a("div",{staticClass:"name"},[t._v(" "+t._s(n.nickname)+" ")])])]}},{key:"fans_label",fn:function(e){var n=e.row;return[a("div",{staticClass:"line-hide"},[t._v(t._s(t.getLabelName(n.tag)))])]}},{key:"attention_status",fn:function(e){var n=e.row;return[1===+n.is_follow?a("kdx-status-text",{attrs:{type:"success"}},[t._v("已关注")]):a("kdx-status-text",{attrs:{type:"danger"}},[t._v("取消关注")])]}},{key:"unfollow_time",fn:function(e){var n=e.row;return[a("div",[t._v(t._s(n.unfollow_time&&"0000-00-00 00:00:00"!==n.unfollow_time?n.unfollow_time:"-"))])]}},{key:"action",fn:function(e){var n=e.row;return[a("Button",{attrs:{type:"text",disabled:t.noManagePerm},on:{click:function(e){return t.addLabel({row:n})}}},[t._v("打标签")]),0===+n.is_black?a("Button",{staticClass:"marginL-10",attrs:{type:"text",disabled:t.noManagePerm},on:{click:function(e){return t.setBlack({row:n,is_black:1})}}},[t._v("加入黑名单")]):a("Button",{staticClass:"marginL-10",attrs:{type:"text",disabled:t.noManagePerm},on:{click:function(e){return t.setBlack({row:n,setBlack:0})}}},[t._v("移除黑名单")])]}}])}),a("div",{directives:[{name:"show",rawName:"v-show",value:t.data.length>0,expression:"data.length > 0"}],staticClass:"footer-action"},[a("Checkbox",{on:{"on-change":t.checkboxChange},model:{value:t.isSelectAll,callback:function(e){t.isSelectAll=e},expression:"isSelectAll"}}),a("Button",{attrs:{disabled:!t.isChecked||t.noManagePerm},on:{click:function(e){return t.addLabel({type:"multiple"})}}},[t._v("打标签")]),"0"===t.tab?a("Button",{attrs:{disabled:!t.isChecked||t.noManagePerm},on:{click:function(e){return t.setBlack({type:"multiple",is_black:1})}}},[t._v("加入黑名单")]):"1"===t.tab?a("Button",{attrs:{disabled:!t.isChecked||t.noManagePerm},on:{click:function(e){return t.setBlack({type:"multiple",is_black:0})}}},[t._v("移除黑名单")]):t._e()],1),a("div",{directives:[{name:"show",rawName:"v-show",value:t.total>10,expression:"total > 10"}],staticClass:"footer-page"},[a("kdx-page-component",{ref:"page",attrs:{current:t.current,pageSize:t.pageSize,total:t.total},on:{"on-change":t.changePage}})],1),a("fans-label",{ref:"fans_label",attrs:{id:t.checkedId,"current-list":t.tabList},on:{"on-refresh":t.handleRefresh}})],1)},i=[]},"852f":function(t,e,a){"use strict";a("067a")},"8e14":function(t,e,a){Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0,a("d81d"),a("d3b7"),a("4de4");var n={name:"LabelModal",props:{id:{type:Array,default:function(){return[]}},currentList:{type:Array,default:function(){return[]}}},data:function(){return{value:!1,loading:!1,list:[],selectRows:[],selectObj:{}}},methods:{setValue:function(){var t=this;this.value=!this.value,this.value&&(console.log("current-list",this.currentList),this.selectObj={},this.selectRows=this.currentList.map((function(e){return t.$set(t.selectObj,e.wechat_tag_id,!0),e})),0===this.list.length&&this.getList())},getList:function(){var t=this;this.loading=!0,this.$api.homeApi.getWechatFansLabelList({pager:0}).then((function(e){0===e.error&&(t.list=e.list||[])})).finally((function(){t.loading=!1}))},handleOk:function(){var t=this,e={fans_id:this.id,wechat_tag_id:this.selectRows.map((function(t){return t.wechat_tag_id}))};this.loading=!0,this.$api.homeApi.setWechatFansLabel(e).then((function(e){0===e.error&&(t.$Message.success("粉丝标签操作成功"),t.setValue(),t.$emit("on-refresh"))})).finally((function(){t.loading=!1}))},selectLabel:function(t){this.selectObj[t.wechat_tag_id]?(this.$set(this.selectObj,t.wechat_tag_id,!1),this.selectRows=this.selectRows.filter((function(e){return e.wechat_tag_id!==t.wechat_tag_id}))):(this.$set(this.selectObj,t.wechat_tag_id,!0),this.selectRows.push(t))}}};e.default=n},"903f":function(t,e,a){"use strict";a.r(e);var n=a("9d65"),i=a("be1b");for(var s in i)["default"].indexOf(s)<0&&function(t){a.d(e,t,(function(){return i[t]}))}(s);a("cfef");var c=a("2877"),l=Object(c["a"])(i["default"],n["a"],n["b"],!1,null,"29b9512d",null);e["default"]=l.exports},"9d65":function(t,e,a){"use strict";a.d(e,"a",(function(){return n})),a.d(e,"b",(function(){return i}));var n=function(){var t=this,e=t.$createElement;t._self._c;return t._m(0)},i=[function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("div",{staticClass:"wechat-empty"},[n("div",{staticClass:"empty-img"},[n("img",{attrs:{src:a("7677"),alt:""}}),n("div",{staticClass:"text"},[t._v(" 您的公众号类型为未认证服务号，暂不支持本功能 ")])])])}]},a603:function(t,e,a){},ac43:function(t,e,a){"use strict";a("f2af")},b323:function(t,e,a){"use strict";a("cd78")},b888:function(t,e,a){"use strict";a.r(e);var n=a("7ec6"),i=a("3b55");for(var s in i)["default"].indexOf(s)<0&&function(t){a.d(e,t,(function(){return i[t]}))}(s);a("b323");var c=a("2877"),l=Object(c["a"])(i["default"],n["a"],n["b"],!1,null,"7bac1d54",null);e["default"]=l.exports},be1b:function(t,e,a){"use strict";a.r(e);var n=a("c3d3"),i=a.n(n);for(var s in n)["default"].indexOf(s)<0&&function(t){a.d(e,t,(function(){return n[t]}))}(s);e["default"]=i.a},c3d3:function(t,e){Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0;var a={name:"WechatEmpty"};e.default=a},cd78:function(t,e,a){},cdbd:function(t,e,a){var n=a("4ea4").default;Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0,a("a9e3"),a("d81d"),a("a15b");var i=n(a("e417")),s={name:"TableList",components:{FansLabel:i.default},props:{data:{type:Array,default:function(){return[]}},total:{type:Number,default:0},current:{type:Number,default:1},pageSize:{type:Number,default:10},loading:{type:Boolean,default:!1},tab:{type:String}},data:function(){return{columns:[{type:"selection",width:40,align:"center"},{title:"粉丝名称",slot:"nickname"},{title:"粉丝标签",slot:"fans_label"},{title:"关注状态",slot:"attention_status"},{title:"关注时间",key:"follow_time"},{title:"取关时间",slot:"unfollow_time"},{title:"操作",slot:"action"}],isSelectAll:!1,selectRows:[],checkedId:[],tabList:[]}},computed:{isChecked:function(){return!!this.selectRows.length},noManagePerm:function(){return!this.$getPermMap("channel.wechat.manage")}},methods:{handleRefresh:function(){this.$emit("on-refresh")},changePage:function(t){this.$emit("on-change-page",t)},resetPage:function(){var t;null===(t=this.$refs["page"])||void 0===t||t.reset()},checkboxChange:function(){this.$emit("on-checkbox",this.isSelectAll),this.isSelectAll?this.selectRows=this.data.map((function(t){return t})):this.selectRows=[]},resetChecked:function(){this.isSelectAll=!1,this.selectRows=[]},addLabel:function(t){var e=this,a=t.type,n=void 0===a?"single":a,i=t.row;"single"===n?(this.checkedId=[i.id],this.tabList=(i.tag||[]).map((function(t){return t.id=t.fans_id,t}))):(this.checkedId=this.selectRows.map((function(t){return t.id})),this.tabList=[]),this.$nextTick((function(){e.$refs["fans_label"].setValue()}))},getLabelName:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[];return null!==t&&void 0!==t&&t.length&&t.map((function(t){return t.tag_name})).join(",")||"-"},selectChange:function(t){this.selectRows=t,this.isSelectAll=this.selectRows.length===this.data.length},setBlack:function(t){var e,a,n=this,i=t.row,s=t.is_black,c=i?[i.id]:this.selectRows.map((function(t){return t.id}));1===s?(e="加入黑名单后，你将无法接收该用户发来的消息，且该用户无法接收公众号发出的消息，无法参与留言和赞赏，确认加入黑名单？",a="加入黑名单成功"):(e="是否移除黑名单",a="移除黑名单成功"),this.$Modal.confirm({title:"提示",content:e,onOk:function(){n.$api.homeApi.setWechatBlackStatus({is_black:s,fans_id:c}).then((function(t){0===t.error&&(n.$Message.success(a),n.handleRefresh())}))}})}}};e.default=s},cfef:function(t,e,a){"use strict";a("a603")},e417:function(t,e,a){"use strict";a.r(e);var n=a("2bd5"),i=a("1c67");for(var s in i)["default"].indexOf(s)<0&&function(t){a.d(e,t,(function(){return i[t]}))}(s);a("852f");var c=a("2877"),l=Object(c["a"])(i["default"],n["a"],n["b"],!1,null,"1577897d",null);e["default"]=l.exports},f2af:function(t,e,a){}}]);