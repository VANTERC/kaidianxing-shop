(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([[77],{"011e":function(t,e,n){"use strict";n.d(e,"a",(function(){return a})),n.d(e,"b",(function(){return o}));var a=function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("kdx-modal-frame",{attrs:{title:"文字回复",value:t.value},on:{"on-cancel":t.cancelHandler},scopedSlots:t._u([{key:"footer",fn:function(){return[n("div",[n("Button",{staticClass:"default-long",on:{click:t.cancelHandler}},[t._v("取消")]),n("Button",{staticClass:"primary-long",on:{click:t.validate}},[t._v("确认")])],1)]},proxy:!0}])},[n("div",{staticClass:"content"},[n("Form",{ref:"form",attrs:{model:t.model,"label-width":120,rules:t.rules}},[n("FormItem",{staticClass:"mb-20",attrs:{label:"文字回复：",prop:"content"}},[n("Input",{staticClass:"width-340",model:{value:t.model.content,callback:function(e){t.$set(t.model,"content",e)},expression:"model.content"}})],1)],1)],1)])},o=[]},"156b":function(t,e,n){"use strict";n.r(e);var a=n("7010"),o=n.n(a);for(var r in a)["default"].indexOf(r)<0&&function(t){n.d(e,t,(function(){return a[t]}))}(r);e["default"]=o.a},"251c":function(t,e,n){},"336c":function(t,e,n){"use strict";n.r(e);var a=n("bef1"),o=n.n(a);for(var r in a)["default"].indexOf(r)<0&&function(t){n.d(e,t,(function(){return a[t]}))}(r);e["default"]=o.a},"3d33":function(t,e,n){var a=n("4ea4").default;Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0;var o=a(n("5530")),r={props:{current:{type:Object,default:function(){}}},data:function(){return{model:{keyword:"",type:"2"},rules:{keyword:[{required:!0,message:"请填写关键词",trigger:"blur"}]},value:!1}},methods:{setValue:function(){this.value=!this.value,this.value&&this.init()},init:function(){var t=this;this.$nextTick((function(){t.current.keyword?t.model=(0,o.default)((0,o.default)({},t.model),t.current):t.model={keyword:"",type:"2"}}))},cancelHandler:function(){this.setValue()},validate:function(){var t=this;this.$refs.form.validate((function(e){e&&t.saveHandler()}))},saveHandler:function(){this.$emit("on-change",(0,o.default)({},this.model)),this.$refs.form.resetFields(),this.cancelHandler()}}};e.default=r},"42ad":function(t,e,n){},5691:function(t,e,n){"use strict";n.r(e);var a=n("011e"),o=n("156b");for(var r in o)["default"].indexOf(r)<0&&function(t){n.d(e,t,(function(){return o[t]}))}(r);n("ad71");var i=n("2877"),l=Object(i["a"])(o["default"],a["a"],a["b"],!1,null,"6182e24c",null);e["default"]=l.exports},"6e2c":function(t,e,n){"use strict";n.r(e);var a=n("c59c"),o=n("cdd3");for(var r in o)["default"].indexOf(r)<0&&function(t){n.d(e,t,(function(){return o[t]}))}(r);n("d749");var i=n("2877"),l=Object(i["a"])(o["default"],a["a"],a["b"],!1,null,"1b30e5b0",null);e["default"]=l.exports},7010:function(t,e){Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0;var n={props:{current:{type:String,default:""}},data:function(){return{model:{content:""},rules:{content:[{required:!0,message:"请填写文字回复",trigger:"blur"}]},value:!1}},methods:{setValue:function(){this.value=!this.value,this.value&&this.init()},init:function(){var t=this;this.$nextTick((function(){t.current?t.model.content=t.current:t.model={content:""}}))},cancelHandler:function(){this.setValue()},validate:function(){var t=this;this.$refs.form.validate((function(e){e&&t.saveHandler()}))},saveHandler:function(){this.$emit("on-change",this.model.content),this.$refs.form.resetFields(),this.cancelHandler()}}};e.default=n},9278:function(t,e,n){"use strict";n("251c")},a022:function(t,e,n){"use strict";n.d(e,"a",(function(){return a})),n.d(e,"b",(function(){return o}));var a=function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("kdx-content-bar",{scopedSlots:t._u([{key:"btn",fn:function(){return[n("Button",{staticClass:"primary-long",attrs:{disabled:t.noManagePerm,loading:t.loading,type:"primary"},on:{click:t.validate}},[t._v("保存")])]},proxy:!0}])},[n("div",{staticClass:"content"},[n("Form",{ref:"form",attrs:{model:t.model,rules:t.rules,"label-width":150}},[n("kdx-form-title",[t._v("基本信息")]),n("FormItem",{attrs:{label:"规则名称：",prop:"name"}},[n("Input",{staticClass:"width-340",attrs:{placeholder:"请输入规则名称"},model:{value:t.model.name,callback:function(e){t.$set(t.model,"name",e)},expression:"model.name"}})],1),n("FormItem",{attrs:{label:"关键词设置：",prop:"rule_keyword_data"}},[n("Button",{attrs:{type:"primary"},on:{click:t.addKeyword}},[t._v("+添加关键词")]),n("div",{staticClass:"table"},[n("Table",{attrs:{draggable:"",border:"",columns:t.keyColumns,data:t.model.rule_keyword_data,size:"small"},on:{"on-drag-drop":t.draggeTable}})],1)],1),n("kdx-form-title",[t._v("回复内容")]),n("FormItem",{attrs:{label:"规则名称："}},[n("RadioGroup",{model:{value:t.model.reply_setting,callback:function(e){t.$set(t.model,"reply_setting",e)},expression:"model.reply_setting"}},[n("Radio",{attrs:{label:"1"}},[t._v("回复首条")]),n("Radio",{attrs:{label:"2"}},[t._v("随机回复一条")]),n("Radio",{attrs:{label:"3"}},[t._v("回复全部")])],1)],1),n("FormItem",{attrs:{label:"添加回复内容：",prop:"rule_content"}},[n("Button",{attrs:{type:"primary"},on:{click:t.addText}},[t._v("+添加文字")]),n("Button",{staticClass:"btn-next",attrs:{type:"primary"},on:{click:t.addImage}},[t._v("+添加图片")]),n("div",{staticClass:"table"},[n("Table",{attrs:{draggable:"",border:"",columns:t.columns,data:t.model.rule_content,size:"small"},on:{"on-drag-drop":t.draggeTable}})],1)],1)],1)],1),n("key-word-modal",{ref:"keyModal",attrs:{current:t.currentKey},on:{"on-change":t.keywordChange}}),n("text-modal",{ref:"textModal",attrs:{current:t.currentContent},on:{"on-change":t.textChange}}),n("image-selector",{ref:"imgModal",attrs:{current:t.currentContent,"return-type":"object"},on:{"on-change":t.imgChange}})],1)},o=[]},ab4f:function(t,e,n){},ad71:function(t,e,n){"use strict";n("ab4f")},bef1:function(t,e,n){var a=n("4ea4").default;Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0,n("d3b7"),n("159b"),n("ac1f"),n("1276"),n("6062"),n("3ca3"),n("ddb0"),n("d81d"),n("a434");var o=a(n("2909")),r=a(n("5530")),i=a(n("15fd")),l=a(n("7177")),d=a(n("6e2c")),c=a(n("5691")),s=["rule_content"],u={components:{KeyWordModal:d.default,TextModal:c.default,ImageSelector:l.default},data:function(){var t=this,e=this.$createElement;return{model:{name:"",containtype:[],rule_keyword_data:[],reply_setting:"1",rule_content:[],module:"wechat"},rules:{name:[{required:!0,message:"请输入规则名称"}],rule_content:[{required:!0,message:"请设置回复内容",type:"array"}],rule_keyword_data:[{required:!0,message:"请设置关键字",type:"array"}]},columns:[{width:60,title:" ",render:function(){return e("i",{class:"iconfont icon-move move-icon"})}},{title:"回复内容",key:"content",render:function(e,n){var a=n.row;return"images"==a.containtype?e("img",{class:"reply-img",attrs:{src:t.$media(a.content.path)},on:{error:function(e){t.replaceImage(e)}}}):e("div",[a.content])}},{title:"操作",width:100,render:function(e,n){var a=n.index;return e("div",[e("Button",{attrs:{type:"text"},on:{click:function(){return t.handleContentEdit(a)}}},["编辑"]),e("Button",{attrs:{type:"text"},class:"btn-next",on:{click:function(){return t.handleRemoveContent(a)}}},["删除"])])}}],loading:!1,keyColumns:[{title:"关键词",key:"keyword"},{title:"匹配",key:"type",render:function(t,e){var n=e.row;return"1"==n.type?t("div",{class:"match_tag strict"},["精准匹配"]):t("div",{class:"match_tag vague"},["模糊匹配"])}},{title:"操作",width:100,render:function(e,n){var a=n.index;return e("div",[e("Button",{attrs:{type:"text"},on:{click:function(){return t.handleEdit(a)}}},["编辑"]),e("Button",{attrs:{type:"text"},class:"btn-next",on:{click:function(){return t.handleRemove(a)}}},["删除"])])}}],keyIndex:-1,contentIndex:-1}},computed:{currentKey:function(){return this.keyIndex>-1?this.model.rule_keyword_data[this.keyIndex]:{}},currentContent:function(){return this.contentIndex>-1?this.model.rule_content[this.contentIndex].content:""},noManagePerm:function(){return!this.$getPermMap("channel.wechat.manage")}},created:function(){var t=this.$route.query.id;t&&(this.model.id=t,this.getKeyInfo(t))},methods:{getKeyInfo:function(t){var e=this;this.$api.homeApi.getKeyWord({id:t}).then((function(t){if(0===t.error){var n=t.data,a=n.rule_content,o=(0,i.default)(n,s);a.forEach((function(t){if("images"===t.containtype){var e,n=(null===(e=t.content)||void 0===e?void 0:e.split("_id="))||[];t.content={id:(null===n||void 0===n?void 0:n[1])||"",path:(null===n||void 0===n?void 0:n[0])||""}}})),e.model=(0,r.default)((0,r.default)((0,r.default)({},e.model),o),{},{rule_content:a})}}))},validate:function(){var t=this;this.$refs.form.validate((function(e){e&&t.submitSave()}))},submitSave:function(){var t=this;this.model.containtype=(0,o.default)(new Set(this.model.rule_content.map((function(t){return t.containtype}))));var e=this.model.id?"updateKeyWord":"addKeyWord",n=new Set,a=[];this.model.rule_content.forEach((function(t){var e={};e="images"===t.containtype?{containtype:t.containtype,content:t.content.path+"_id="+t.content.id,attachment_id:t.content.id}:{containtype:t.containtype,content:t.content},t.id&&(e.id=t.id),n.add(t.containtype),a.push(e)}));var i=(0,r.default)((0,r.default)({},this.model),{},{containtype:(0,o.default)(n),rule_content:a});this.loading=!0,this.$api.homeApi[e](i).then((function(e){0==e.error&&(t.$Message.success("保存成功"),t.$router.back())})).finally((function(){t.loading=!1}))},addKeyword:function(){this.keyIndex=-1,this.$refs.keyModal.setValue()},keywordChange:function(t){var e=this;-1==this.keyIndex||t.keyword!=this.model.rule_keyword_data[this.keyIndex].keyword?this.$api.homeApi.checkKeyWord({keyword:t.keyword}).then((function(n){0===n.error&&(-1==e.keyIndex?e.model.rule_keyword_data.push(t):e.$set(e.model.rule_keyword_data,e.keyIndex,t))})):this.$set(this.model.rule_keyword_data,this.keyIndex,t)},handleEdit:function(t){this.keyIndex=t,this.$refs.keyModal.setValue()},handleRemove:function(t){this.model.rule_keyword_data.splice(t,1)},addText:function(){this.contentIndex=-1,this.$refs.textModal.setValue()},addImage:function(){this.contentIndex=-1,this.$refs.imgModal.setValue()},handleContentEdit:function(t){this.contentIndex=t,"images"==this.model.rule_content[t].containtype?this.$refs.imgModal.setValue():this.$refs.textModal.setValue()},handleRemoveContent:function(t){this.model.rule_content.splice(t,1)},textChange:function(t){-1==this.contentIndex?this.model.rule_content.push({containtype:"text",content:t}):this.$set(this.model.rule_content[this.contentIndex],"content",t)},imgChange:function(t){-1==this.contentIndex?this.model.rule_content.push({containtype:"images",content:t}):t&&this.$set(this.model.rule_content[this.contentIndex],"content",t)},draggeTable:function(t,e){var n=this.model.rule_content,a=(0,r.default)({},n[t]);Object.assign(n[t],n[e]),Object.assign(n[e],a)}}};e.default=u},c59c:function(t,e,n){"use strict";n.d(e,"a",(function(){return a})),n.d(e,"b",(function(){return o}));var a=function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("kdx-modal-frame",{attrs:{title:"关键词",value:t.value},on:{"on-cancel":t.cancelHandler},scopedSlots:t._u([{key:"footer",fn:function(){return[n("div",[n("Button",{staticClass:"default-long",on:{click:t.cancelHandler}},[t._v("取消")]),n("Button",{staticClass:"primary-long",on:{click:t.validate}},[t._v("确认")])],1)]},proxy:!0}])},[n("div",{staticClass:"content"},[n("Form",{ref:"form",attrs:{model:t.model,"label-width":120,rules:t.rules}},[n("FormItem",{staticClass:"mb-20",attrs:{label:"关键词：",prop:"keyword"}},[n("Input",{staticClass:"width-340",model:{value:t.model.keyword,callback:function(e){t.$set(t.model,"keyword",e)},expression:"model.keyword"}})],1),n("FormItem",{staticClass:"mb-20",attrs:{label:"匹配规则："}},[n("RadioGroup",{model:{value:t.model.type,callback:function(e){t.$set(t.model,"type",e)},expression:"model.type"}},[n("Radio",{attrs:{label:"2"}},[t._v("模糊匹配")]),n("Radio",{attrs:{label:"1"}},[t._v("精准匹配")])],1)],1)],1)],1)])},o=[]},cdd3:function(t,e,n){"use strict";n.r(e);var a=n("3d33"),o=n.n(a);for(var r in a)["default"].indexOf(r)<0&&function(t){n.d(e,t,(function(){return a[t]}))}(r);e["default"]=o.a},d07f:function(t,e,n){"use strict";n.r(e);var a=n("a022"),o=n("336c");for(var r in o)["default"].indexOf(r)<0&&function(t){n.d(e,t,(function(){return o[t]}))}(r);n("9278");var i=n("2877"),l=Object(i["a"])(o["default"],a["a"],a["b"],!1,null,"6ce9cfa4",null);e["default"]=l.exports},d749:function(t,e,n){"use strict";n("42ad")}}]);